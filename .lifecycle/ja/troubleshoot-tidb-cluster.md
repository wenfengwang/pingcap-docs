---
title: TiDBクラスターのトラブルシューティングガイド
summary: TiDBを使用する際に問題を診断および解決する方法を学ぶ
aliases: ['/docs/dev/troubleshoot-tidb-cluster/', '/docs/dev/how-to/troubleshoot/cluster-setup/']
---

# TiDBクラスターのトラブルシューティングガイド

このガイドを使用して、TiDBを使用しながら基本的な問題を診断および解決できます。問題が解決されない場合は、以下の情報を収集して[バグを報告](/support.md)できます:

- 正確なエラーメッセージとエラーが発生する操作
- すべてのコンポーネントの状態
- エラーを報告するコンポーネントのログにある`error`/`fatal`/`panic`の情報
- 構成および展開トポロジー
- `dmesg`でのTiDBコンポーネント関連の問題

その他の情報については、[よくある質問（FAQ）](/faq/tidb-faq.md)を参照してください。

## データベースに接続できない

1. `tidb-server`、`pd-server`、`tikv-server`を含むすべてのサービスが起動していることを確認します。
2. すべてのプロセスが実行中かどうかを確認するために`ps`コマンドを使用します。

    - 特定のプロセスが実行されていない場合は、以下の対応するセクションを参照して問題を診断および解決します。

    + すべてのプロセスが実行されている場合は、`tidb-server`のログを確認して、次のメッセージが表示されているかどうかを確認します:
        - InformationSchemaが古い: これは`tikv-server`に接続できない場合に表示されるメッセージです。`pd-server`および`tikv-server`の状態とログを確認してください。
        - panic: これはプログラムに問題がある場合に表示されるメッセージです。詳細なパニックログを提供して[バグを報告](/support.md)してください。

3. データがクリアされ、サービスが再展開された場合は、次のことを確認してください:

    - `tikv-server`と`pd-server`のすべてのデータがクリアされていること。特定のデータは`tikv-server`に保存され、メタデータは`pd-server`に保存されます。2つのサーバーのうち1つだけがクリアされた場合、データが不整合になります。
    - `pd-server`および`tikv-server`のデータがクリアされ、`pd-server`および`tikv-server`が再起動された後、`tidb-server`も再起動する必要があります。`pd-server`が初期化されるとクラスターIDがランダムに割り当てられます。したがって、クラスターが再展開されるとクラスターIDが変更され、新しいクラスターIDを取得するために`tidb-server`を再起動する必要があります。

## `tidb-server`を起動できない

`tidb-server`を起動できない状況については以下を参照してください:

- 起動パラメーターでエラーが発生している場合。[TiDB構成とオプション](/command-line-flags-for-tidb-configuration.md)を参照してください。

- ポートが使用中である場合。`lsof -i:port`コマンドを使用して指定されたポートに関連するすべてのネットワークを表示し、`tidb-server`を開始するポートが占有されていないことを確認します。

+ `pd-server`に接続できない。

    - TiDBとPDの間のネットワークが正常に動作しているかどうかを確認します。ネットワークがpingできるかどうか、またファイアウォール構成に問題がないかどうかを含みます。
    - ネットワークに問題がない場合は、`pd-server`プロセスの状態とログを確認してください。

## `tikv-server`を起動できない

`tidb-server`を起動できない状況については以下を参照してください:

- 起動パラメーターでエラーが発生している場合。[TiKV構成とオプション](/command-line-flags-for-tikv-configuration.md)を参照してください。

- ポートが使用中である場合。`lsof -i:port`コマンドを使用して指定されたポートに関連するすべてのネットワークを表示し、`tikv-server`を開始するポートが占有されていないことを確認します。

+ `pd-server`に接続できない。

    - TiDBとPDの間のネットワークが正常に動作しているかどうかを確認します。ネットワークがpingできるかどうか、またファイアウォール構成に問題がないかどうかを含みます。

    - ネットワークに問題がない場合は、`pd-server`プロセスの状態とログを確認してください。

- ファイルが使用中です。

    1つのデータベースファイルディレクトリに2つのTiKVファイルを開かないでください。

## `pd-server`を起動できない

`pd-server`を起動できない状況については以下を参照してください:

- 起動パラメーターでエラーが発生している場合。[PD構成とオプション](/command-line-flags-for-pd-configuration.md)を参照してください。

- ポートが使用中である場合。`lsof -i:port`コマンドを使用して指定されたポートに関連するすべてのネットワークを表示し、`pd-server`を開始するポートが占有されていないことを確認します。

## TiDB/TiKV/PDプロセスが予期せず中止する

- プロセスは前面で開始されていますか？クライアントが中止したためにプロセスが終了する可能性があります。

- コマンドラインで`nohup+&`が実行されていますか？これによりプロセスが中止される可能性があるため、起動コマンドをスクリプトに記述して実行することをお勧めします。

## TiDBパニック

詳細なパニックログを提供して[バグを報告](/support.md)してください。

## 接続が拒否される

オペレーティングシステムのネットワークパラメーターが正しいことを確認してください。以下に含まれるがこれに限定されない:

- 接続文字列中のポートが`tidb-server`の開始ポートと一致していること。
- ファイアウォールが正しく構成されていること。

## ファイルを開く数が多すぎます

プロセスを開始する前に、`ulimit -n`の結果が十分大きいことを確認してください。値を`unlimited`または`1000000`以上に設定することをお勧めします。

## データベースのアクセスがタイムアウトし、システム負荷が高すぎる

まず、[遅いクエリログ](/identify-slow-queries.md)をチェックし、不適切なSQLステートメントに起因しているかどうかを確認してください。

問題を解決できない場合は、以下の情報を提供してください:

+ 展開トポロジー

    - 何台の`tidb-server`/`pd-server`/`tikv-server`インスタンスが展開されていますか？
    - これらのインスタンスはどのようにしてマシンに分散されていますか？

+ これらのインスタンスが展開されているマシンのハードウェア構成:

    - CPUコア数
    - メモリのサイズ
    - ディスクのタイプ（SSDまたはハードディスク）
    - 物理マシンまたは仮想マシンですか？

- TiDBクラスター以外に他のサービスがありますか？
- `pd-server`と`tikv-server`は別々に展開されていますか？
- 現在の操作は何ですか？
- `top -H`コマンドを使用してCPUスレッド名を確認してください。
- 最近のネットワークまたはIOモニタリングデータに例外がありますか？