---
title: TiFlash コマンドラインフラグ
summary: TiFlash のコマンドライン起動フラグを学ぶ
aliases: ['/docs/dev/tiflash/tiflash-command-line-flags/']
---

# TiFlash コマンドラインフラグ

このドキュメントでは、TiFlashを起動する際に使用できるコマンドラインフラグについて紹介します。

## `server --config-file`

+ TiFlash 構成ファイルのパスを指定します
+ デフォルト: ""
+ 詳細な構成項目については、[TiFlash 構成パラメータ](/tiflash/tiflash-configuration.md)を参照してください。

## `dttool migrate`

- DTFile のファイル形式を移行します（テストまたはダウングレード）。データは単一の DTFile 単位で移行されます。テーブル全体を移行する場合は、`<data dir>/t_<table id>/stable/dmf_<file id>` と似たパスをすべて特定し、それらを1つずつ移行する必要があります。移行を自動化するためにスクリプトを使用できます。

- ユーザシナリオ:
    - TiFlash をバージョン >= v5.4.0（データ検証が有効になっている）からバージョン < v5.4.0 にダウングレードする必要がある場合、このツールを使用して DTFile のデータ形式をダウングレードできます。
    - TiFlash をバージョン >= v5.4.0 にアップグレードし、既存データにデータ検証を有効にしたい場合、このツールを使用して DTFile のデータ形式をアップグレードできます。
    - 異なる構成での DTFile のスペース使用量と読み取り速度をテストします。
    - TiFlash をバージョン >= v7.3.0（すなわち、`storage.format_version` >= 5 が有効になっている）からバージョン < v7.3.0 にダウングレードする必要がある場合、このツールを使用して DTFile のデータ形式をダウングレードできます。

- パラメータ:
    - `--imitative`: DTFile の暗号化機能を使用しない場合、このフラグを使用して構成ファイルを使わず PD に接続しないようにできます。
    - `--version`: DTFile のターゲットバージョン。値の選択肢は `1`, `2`（デフォルト）, `3` です。`1` は古いバージョン、`2` は新しいチェックサムに対応するバージョン、`3` は小さなファイルのマージをサポートするバージョンです。
    - `--algorithm`: データ検証に使用されるハッシュアルゴリズム。値の選択肢は `xxh3`（デフォルト）, `city128`, `crc32`, `crc64`, `none` です。このパラメータは `version` が `2` の場合にのみ有効です。
    - `--frame`: 検証フレームのサイズ。デフォルト値は `1048576` です。このパラメータは `version` が `2` の場合にのみ有効です。
    - `--compression`: ターゲットの圧縮アルゴリズム。値の選択肢は `LZ4`（デフォルト）, `LZ4HC`, `zstd`, `none` です。
    - `--level`: ターゲットの圧縮レベル。指定しない場合、圧縮アルゴリズムに応じてデフォルトで推奨される圧縮レベルが使用されます。`compression` が `LZ4` または `zstd` に設定されている場合、デフォルトレベルは 1 です。`compression` が `LZ4HC` に設定されている場合、デフォルトレベルは 9 です。
    - `--config-file`: `dttool migrate` の構成ファイルは [`server` の構成ファイル](/tiflash/tiflash-command-line-flags.md#server---config-file)と同じです。詳細については `--imitative` を参照してください。
    - `--file-id`: DTFile の ID。例えば、DTFile `dmf_123` の ID は `123` です。
    - `--workdir`: `dmf_xxx` の親ディレクトリです。
    - `--dry`: ドライランモード。移行プロセスのみが出力されます。
    - `--nokeep`: 元のデータを保持しません。このオプションが有効にされていない場合、`dmf_xxx.old` ファイルが作成されます。

> **警告:**
>
> TiFlash はカスタム圧縮アルゴリズムと圧縮レベルを使用した DTFile を読み取ることができます。ただし、公式にサポートされているのはデフォルト圧縮レベルの `lz4` アルゴリズムのみです。カスタム圧縮パラメータは徹底的にテストされておらず、実験段階のみです。

> **注意:**
>
> セキュリティ上の理由から、DTTool は移行モードで作業ディレクトリにロックを追加しようとします。したがって、同じディレクトリ内では同時に1つの DTTool のみが移行タスクを実行できます。ロックが解除されていないディレクトリで DTTool を強制停止すると、後で DTTool を再起動しようとしたときに移行タスクを実行することが拒否される可能性があります。
>
> このような状況に遭遇し、LOCK ファイルを削除してもデータの破損が発生しないことを確認している場合、作業ディレクトリ内の LOCK ファイルを手動で削除してロックを解除できます。

## `dttool bench`

- DTFile の基本的な I/O スピードテストを提供します。
- パラメータ:

    - `--version`: DTFile のバージョン。[`dttool migrate` の `--version`](#dttool-migrate)を参照してください。
    - `--algorithm`: データ検証に使用されるハッシュアルゴリズム。[`dttool migrate` の `--algorithm`](#dttool-migrate)を参照してください。
    - `--frame`: 検証フレームのサイズ。[`dttool migrate` の `--frame`](#dttool-migrate)を参照してください。
    - `--column`: テストされるテーブルのカラム。デフォルト値は `100` です。
    - `--size`: テストされるテーブルの行数。デフォルト値は `1000` です。
    - `--field`: テストされるテーブルのフィールド長の制限。デフォルト値は `1024` です。
    - `--random`: ランダムシード。このパラメータを指定しない場合、ランダムシードはシステムのエントロピープールから引かれます。
    - `--encryption`: 暗号化機能を有効にします。
    - `--repeat`: テストを繰り返す回数。デフォルト値は `5` です。
    - `--workdir`: テンポラリデータディレクトリ。ファイルシステム内のパスを指すもので、デフォルト値は `/tmp/test` です。

## `dttool inspect`

- DTFile の整合性をチェックします。データ検証は単一の DTFile 単位で実行されます。テーブル全体を検証する場合は、`<data dir>/t_<table id>/stable/dmf_<file id>` と似たパスをすべて特定し、1つずつ検証する必要があります。検証を自動化するためにスクリプトを使用できます。

- ユーザシナリオ:
    - フォーマットのアップグレードまたはダウングレードを実行した後、DTFile のデータ整合性を検証できます。
    - DTFile を新しい環境に移行した後、DTFile のデータ整合性を検証できます。

- パラメータ:

    - `--config-file`: `dttool bench` の構成ファイル。[`dttool migrate` の `--config-file`](#dttool-migrate)を参照してください。
    - `--check`: ハッシュ検証を実行します。
    - `--file-id`: DTFile の ID。[`dttool migrate` の `--file-id`](#dttool-migrate)を参照してください。
    - `--imitative`: データベースコンテキストを模倣します。[`dttool migrate` の `--imitative`](#dttool-migrate)を参照してください。
    - `--workdir`: データディレクトリ。[`dttool migrate` の `--workdir`](#dttool-migrate)を参照してください。