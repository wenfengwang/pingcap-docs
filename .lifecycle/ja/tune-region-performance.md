---
title: リージョンのパフォーマンスチューニング
summary: リージョンのサイズを調整してリージョンのパフォーマンスをチューニングし、リージョンサイズが大きい場合に同時クエリの最適化にバケツを使用する方法を学ぶ。

# リージョンのパフォーマンスチューニング

このドキュメントでは、リージョンのサイズを調整してリージョンのパフォーマンスをチューニングする方法と、リージョンサイズが大きい場合に同時クエリの最適化にバケツを使用する方法について紹介します。

## 概要

TiKVは自動的に[下層データをシャード化](/best-practices/tidb-best-practices.md#data-sharding)します。データはキー範囲に基づいて複数のリージョンに分割されます。リージョンのサイズがしきい値を超えると、TiKVはそれを2つ以上のリージョンに分割します。

大量のデータを処理する際に、TiKVは多くのリージョンを分割する可能性があります。これにより、より多くのリソース消費と[パフォーマンスの低下](/best-practices/massive-regions-best-practices.md#performance-problem)が引き起こされます。一定量のデータに対して、リージョンサイズが大きいほどリージョンの数が少なくなります。v6.1.0以降、TiDBはカスタムリージョンサイズの設定をサポートしています。リージョンのデフォルトサイズは96 MiBです。リージョンの数を減らすためには、リージョンをより大きなサイズに調整することができます。

多くのリージョンによるパフォーマンスオーバーヘッドを減らすためには、[リージョンのハイバネーション](/best-practices/massive-regions-best-practices.md#method-4-increase-the-number-of-tikv-instances)または[`リージョン統合`](/best-practices/massive-regions-best-practices.md#method-5-adjust-raft-base-tick-interval)を有効にすることもできます。

## `region-split-size`を使用してリージョンサイズを調整する

> **警告:**
>
> 現在、カスタムリージョンサイズはTiDB v6.1.0で導入された実験的な機能です。本番環境での使用は推奨されません。リスクは以下の通りです：
>
> + パフォーマンスの揺らぎが発生する可能性があります。
> + 特に大量のデータを扱うクエリのパフォーマンスが低下する可能性があります。
> + リージョンのスケジューリングが遅くなります。

リージョンサイズを調整するには、[`coprocessor.region-split-size`](/tikv-configuration-file.md#region-split-size)構成項目を使用できます。推奨されるサイズは96 MiB、128 MiB、または256 MiBです。`region-split-size`の値が大きいほどパフォーマンスの揺れが大きくなります。リージョンのサイズを1 GiBを超えるように設定することは推奨されません。サイズを10 GiBを超えるように設定することは避けてください。TiFlashを使用する場合、リージョンのサイズは256 MiBを超えてはいけません。

Dumplingツールを使用する場合、リージョンのサイズは1 GiBを超えてはいけません。この場合、リージョンのサイズを増やした後は並行性を減らす必要があります。さもなければ、TiDBはメモリ不足になる可能性があります。

## バケツを使用して並行性を増やす

> **警告:**
>
> 現在、これはTiDB v6.1.0で導入された実験的な機能です。本番環境での使用は推奨されません。

リージョンが大きいサイズに設定されている場合、クエリの並行性を高めるために[`coprocessor.enable-region-bucket`](/tikv-configuration-file.md#enable-region-bucket-new-in-v610)を`true`に設定する必要があります。この構成を使用すると、リージョンはバケツに分割されます。バケツはリージョン内の小さな範囲であり、スキャン並行性を向上させるための同時クエリの単位として使用されます。バケツのサイズは[`coprocessor.region-bucket-size`](/tikv-configuration-file.md#region-bucket-size-new-in-v610)を使用して制御できます。