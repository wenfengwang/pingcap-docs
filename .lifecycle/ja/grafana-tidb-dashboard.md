---
title: TiDBモニタリングメトリクス
summary: Grafana TiDBダッシュボードに表示されるいくつかの主要なメトリクスを学ぶ。
aliases: ['/docs/dev/grafana-tidb-dashboard/','/docs/dev/reference/key-monitoring-metrics/tidb-dashboard/']
---

# TiDBモニタリングメトリクス

TiUPを使用してTiDBクラスタを展開した場合、監視システム（Prometheus & Grafana）は同時に展開されます。監視アーキテクチャについては、[TiDBモニタリングフレームワーク概要](/tidb-monitoring-framework.md) を参照してください。

Grafanaダッシュボードは、概要、PD、TiDB、TiKV、Node_exporter、Disk Performance、およびPerformance_overviewなどの一連のサブダッシュボードに分かれています。TiDBダッシュボードにはTiDBパネルとTiDBサマリーパネルが含まれています。2つのパネルの違いは次の点です。

- TiDBパネル: クラスターの異常をトラブルシューティングするために可能な限り包括的な情報を提供します。
- TiDBサマリーパネル: ユーザーが日常のデータベース操作で興味を持つ情報（QPS、TPS、レスポンス遅延など）を抽出し、一部修正したTiDBパネルの情報を提供します。これは、表示または報告するモニタリング情報となります。

この文書は、TiDBダッシュボードに表示されるいくつかの主要なモニタリングメトリクスを説明します。

## 主要メトリクスの説明

TiDBダッシュボードに表示される主要なメトリクスを理解するには、次のセクションを確認してください。

### クエリサマリー

- 実行時間：実行時間
    - クライアントのネットワークリクエストがTiDBに送信され、TiDBがそれを実行した後にクライアントに返されるまでの時間。一般的には、クライアントのリクエストはSQLステートメントの形で送信されますが、`COM_PING`、`COM_SLEEP`、`COM_STMT_FETCH`、`COM_SEND_LONG_DATA`などのコマンドの実行時間も含まれる場合があります。
    - TiDBはMulti-Queryをサポートしており、`select 1; select 1; select 1;`のように複数のSQLステートメントを一度に送信することをサポートしています。この場合、このクエリの総実行時間には、すべてのSQLステートメントの実行時間が含まれます。
- 1秒あたりのコマンド数：TiDBが処理するコマンドの数（コマンドの実行結果の成功または失敗に応じて分類されます）
- QPS：すべてのTiDBインスタンスで実行される1秒あたりのSQLステートメントの数。`SELECT`、`INSERT`、`UPDATE`などの種類ごとにカウントされます
- インスタンス別CPS：各TiDBインスタンスのコマンドの統計情報。コマンドの実行結果の成功または失敗に応じて分類されます
- 失敗したクエリOPM：各TiDBインスタンスで分類されたエラータイプの統計（構文エラーや主キーコンフリクトなど）。各TiDBインスタンスで実行されるSQLステートメントごとのエラーが発生した統計情報。エラーが発生するモジュールとエラーコードが含まれます
- 遅いクエリ：遅いクエリの処理時間の統計（遅いクエリ全体の所要時間、Coprocessorの所要時間、Coprocessorスケジューリングの待機時間）。遅いクエリは内部SQLステートメントと一般的なSQLステートメントに分類されます
- 接続アイドル期間：アイドル接続の期間
- 999/99/95/80期間：異なるタイプのSQLステートメント（異なるパーセンタイル）の実行時間の統計

### クエリ詳細

- インスタンス別の80/95/99/999実行時間：各TiDBインスタンスでのSQLステートメントの実行時間の統計（異なるパーセンタイル）
- 失敗したクエリOPM詳細：各TiDBインスタンスで実行されるSQLステートメントごとのエラータイプの統計（構文エラーや主キーコンフリクトなど）
- 内部SQL OPS：クラスタ全体で1秒あたりに実行される内部SQLステートメント。内部SQLステートメントは内部的に実行され、通常はユーザーSQLステートメントまたは内部スケジュールされたタスクによってトリガーされます。

### サーバー

- 起動時間：各TiDBインスタンスの動作時間
- メモリ使用率：各TiDBインスタンスのメモリ使用統計。プロセスが占有するメモリとGolangがヒープ上で適用するメモリに分割されます
- CPU使用率：各TiDBインスタンスのCPU使用統計
- 接続数：各TiDBインスタンスに接続しているクライアントの数
- 開いているFD数：各TiDBインスタンスの開いているファイルディスクリプタの統計
- 切断数：各TiDBインスタンスから切断されたクライアントの数
- イベントOPM：`start`、`close`、`graceful-shutdown`、`kill`、`hang`などの重要なイベントの統計
- Goroutine数：各TiDBインスタンスでのGoroutineの数
- Prepareステートメント回数：各TiDBインスタンスで実行された`Prepare`ステートメントの数およびその合計回数
- Keep Alive OPM：各TiDBインスタンスで1分ごとにメトリックがリフレッシュされる回数。通常は注意が必要ありません
- パニックと致命的なエラー：TiDBで発生したパニックと致命的なエラーの統計
- タイムジャンプバックOPS：各TiDBインスタンスで秒ごとにオペレーティングシステムが巻き戻しを行う回数
- トークン取得時間：接続ごとにトークンを取得する時間のコスト
- Binlogスキップ回数：TiDBでのbinlog書き込み失敗の回数
- クライアントデータトラフィック：TiDBとクライアントのデータトラフィックの統計

### トランザクション

- トランザクションOPS：1秒あたりに実行されるトランザクションの数
- 実行時間：トランザクションの実行時間
- トランザクションステートメント数：トランザクション内のSQLステートメントの数
- トランザクションリトライ数：トランザクションがリトライする回数
- セッションリトライエラーOPS：トランザクションのリトライ中に遭遇したエラーの数（リトライ失敗と最大リトライ回数を超えるエラー）。このメトリックには、リトライ失敗と最大リトライ回数を超えるエラーの2つのエラータイプが含まれます
- コミットトークン待機時間：トランザクションのコミット中にフローコントロールキューでの待機時間。待機時間が長い場合、コミットするトランザクションが大きすぎてフローが制御されていることを意味します。システムにまだリソースが利用可能な場合、システム変数`tidb_committer_concurrency`を増やすことでコミットプロセスを高速化できます。
- KVトランザクションOPS：各TiDBインスタンス内で1秒あたりに実行されるトランザクションの数
    - ユーザートランザクションは、内部メタデータの読み取りやユーザートランザクションのアトミックリトライなど、TiDBで複数のトランザクションの実行をトリガーする場合があります
    - TiDBの内部的にスケジュールされたタスクもトランザクションを介してデータベース上で操作を行うため、それらもこのパネルに含まれます
- KVトランザクション実行時間：各TiDB内でトランザクションの実行にかかる時間
- トランザクションリージョン数：トランザクションで操作されるリージョンの数
- トランザクション書き込みKV数率および合計：トランザクションで書き込まれたKVの割合とその合計数
- トランザクション書き込みKV数：トランザクションで操作されたKVの数
- ステートメントロックキー：単一ステートメントのロック数
- ハートビート送信時間：トランザクションがハートビートを送信する時間
- トランザクション書き込みサイズバイト率および合計：トランザクションで書き込まれたバイト数の割合とその合計
- トランザクション書き込みサイズバイト：トランザクションで書き込まれたデータのサイズ
- 悲観的ロックの取得時間：ロックの追加にかかる時間
- TTLライフタイム到達カウンター：TTLの上限に到達したトランザクションの数。TTL上限のデフォルト値は1時間です。悲観的なトランザクションの最初のロックから1時間が経過したことを意味し、オプティミスティックトランザクションの最初の事前書き込みから1時間が経過したことを意味します。TTL寿命の上限値はTiDBの構成ファイルで`max-txn-TTL`を変更することで変更できます
- Safepoint OPSのロード：`Safepoint`のロード回数。`Safepoint`は、トランザクションがデータを読み取るときに`Safepoint`以降のデータが読み取られないようにするためのもので、データの安全性を確保します。`Safepoint`以前のデータはGCによってクリーンアップされる可能性があります
- 悲観的ステートメントのリトライOPS：悲観的ステートメントのリトライ試行回数。ステートメントがロックを追加しようとしたときに書き込み競合が発生する場合があります。この時、ステートメントは新しいスナップショットを取得して再度ロックを追加します
- 秒ごとのトランザクションタイプ：2段階コミット（2PC）、非同期コミット、一段コミット（1PC）メカニズムを使用してコミットされたトランザクションの数。成功したトランザクションと失敗したトランザクションの両方が含まれます

### Executor

- パース時間：SQLステートメントの解析時間の統計
- コンパイル時間：解析されたSQL ASTを実行計画にコンパイルする時間の統計
- 実行時間：SQLステートメントの実行時間の統計
- エグゼクティブOPS：秒ごとに多くのシステムリソースを消費するオペレーターの統計。`Merge Join`、`Hash Join`、`Index Look Up Join`、`Hash Agg`、`Stream Agg`、`Sort`、`TopN`などが含まれます
- プランキャッシュを使用するクエリOPS：秒ごとにプランキャッシュを使用するクエリの統計
- プランキャッシュミスOPS：プランキャッシュが1秒ごとにミスした回数の統計
- プランキャッシュメモリ使用率：各TiDBインスタンスでキャッシュされた実行計画によって消費される合計メモリ
- プランキャッシュプラン数：各TiDBインスタンスでキャッシュされた実行計画の合計数

### Distsql

- Distsql実行時間：Distsqlステートメントの処理時間
- Distsql QPS：Distsqlステートメントの統計
- Distsql Partial QPS：1秒ごとのPartial結果の数
- スキャンキーの数：各クエリがスキャンするキーの数
- 部分的なスキャンキーの数：各部分結果がスキャンするキーの数
- 部分数：各SQLステートメントの部分結果の数
### KV Errors

- KV Backoff Duration: KVリトライリクエストが持続する合計時間です。 TiDBはTiKVへのリクエストの送信中にエラーが発生する場合があります。 TiDBはTiKVへの各リクエストに対してリトライメカニズムを持っています。 この `KV Backoff Duration` 項目はリクエストのリトライの合計時間を記録しています。
- TiClient Region Error OPS: TiKVから返されたRegion関連のエラーメッセージの数
- KV Backoff OPS: TiKVから返されたエラーメッセージの数
- Lock Resolve OPS: TiDBの読み書きリクエストがロックに遭遇した場合、そのロックを解決しようとするTiDBの操作の数
- その他のエラーOPS: ロックのクリアや `SafePoint` の更新など、その他のタイプのエラーの数

### KVリクエスト

TiKVに送信されるリクエストに関連する以下のメトリクス。リトライリクエストは複数回カウントされます。

- KV Request OPS: TiKVによって表示されたKVリクエストの実行回数
- KV Request Duration 99 by store: TiKVによって表示されたKVリクエストの実行時間
- KV Request Duration 99 by type: リクエストのタイプによって表示されたKVリクエストの実行時間
- 古い読み取りヒット/Missオペレーション
    - **hit**: 古い読み取りが成功したリクエストの毎秒数
    - **miss**: 古い読み取りが試みられたが失敗したリクエストの毎秒数
- 古い読み取り要求オペレーション:
    - **cross-zone**: リモートゾーンでの古い読み取りを試みたリクエストの毎秒数
    - **local**: ローカルゾーンでの古い読み取りを試みたリクエストの毎秒数
- 古い読み取り要求数トラフィック:
    - **cross-zone-in**: リモートゾーンでの古い読み取りを試みるリクエストへの応答の着信トラフィック
    - **cross-zone-out**: リモートゾーンでの古い読み取りを試みるリクエストの着信トラフィック
    - **local-in**: ローカルゾーンでの古い読み取りを試みるリクエストへの応答の着信トラフィック
    - **local-out**: ローカルゾーンでの古い読み取りを試みるリクエストの着信トラフィック

### PDクライアント

- PDクライアントCMD OPS: PDクライアントによって実行されるコマンドの統計、毎秒
- PDクライアントCMD Duration: PDクライアントがコマンドを実行するのにかかる時間
- PDクライアントCMD Fail OPS: PDクライアントによって失敗したコマンドの統計、毎秒
- PD TSO OPS: TiDBがPDから取得するTSOの数、毎秒
- PD TSO Wait Duration: TiDBがPDからTSOを返すのを待つ時間
- PD TSO RPC duration: TiDBがPDにリクエストを送信してTSOを受信するまでの時間
- Start TSO Wait Duration: TiDBがPDにリクエストを送信して `start TSO` を受信するまでの時間

### スキーマ読み込み

- スキーマ読み込み時間: TiDBがTiKVからスキーマを取得するのにかかる時間
- スキーマ読み込みOPS: TiDBがTiKVから1秒あたりに取得するスキーマの統計
- スキーマリースエラーOPM: Schema Leaseエラーは `change` と `outdate` の2種類があります。 `change` はスキーマが変更されたことを意味し、 `outdate` はスキーマが更新できないことを意味し、より深刻なエラーでアラートをトリガします。
- 特権読み込みOPS: TiDBがTiKVから1秒あたりに取得する特権情報の統計

### DDL

- DDL Duration 95: DDLステートメント処理時間の95%分位数
- Batch Add Index Duration 100: インデックスの作成に各バッチでかかる最大時間の統計
- DDL待機中のジョブ数: 待機中のDDLタスクの数
- DDL META OPM: DDLが1分ごとにMETAを取得した回数
- DDL Worker Duration 99: 各DDLワーカーの実行時間の99%分位数
- Deploy Syncer Duration: スキーマバージョンシンカーの初期化、再起動、およびクリアアップ操作にかかる時間
- Owner Handle Syncer Duration: DDLオーナーがスキーマバージョンの更新、取得、およびチェックにかかる時間
- Update Self Version Duration: スキーマバージョンシンカーのバージョン情報を更新するのにかかる時間
- DDL OPM: 1秒あたりのDDL実行回数
- DDLバックフィル進捗率: バックフィルDDLタスクの進捗率

### 統計

- 自動Analyze Duration 95: 自動 `ANALYZE` にかかる時間
- 自動Analyze QPS: 自動 `ANALYZE` の統計
- 統計不正確率: 統計の不正確率の情報
- 仮想推定OPS: 仮想統計を使用して最適化されたSQLステートメントの数
- ダンプフィードバックOPS: 格納された統計フィードバックの数
- ストアクエリフィードバックQPS: TiDBメモリで実行される連合クエリのフィードバック情報を格納するための操作の数、毎秒
- 重要なフィードバック: 統計情報を更新する重要なフィードバックの数
- 統計情報更新OPS: フィードバックを使用して統計情報を更新する操作の数

### Owner

- 新しいETCDセッションのDuration 95: 新しいetcdセッションを作成するのにかかる時間。TiDBはetcdクライアントを介してPDのetcdに接続し、メタデータ情報を保存/読み取りします。これはセッションを作成するのにかかる時間を記録します
- オーナーウォッチャー OPS: DDLオーナーがPDのetcdメタデータをウォッチするGoroutine操作の数、毎秒

### メタ

- AutoID QPS: AutoID関連の統計情報。グローバルIDの割り当て、単一テーブルAutoIDの割り当て、単一テーブルAutoIDの再ベースを含む3つの操作
- AutoID Duration: AutoID関連操作にかかる時間
- リージョンキャッシュエラーOPS: TiDB内のキャッシュされたリージョン情報で毎秒遭遇するエラーの数
- メタオペレーションDuration 99: メタオペレーションの待ち時間

### GC

- Worker Action OPM: `run_job`, `resolve_lock`, および `delete_range` を含むGC関連操作の数
- Duration 99: GC関連操作にかかる時間
- 設定: GCデータのライフタイムとGCの実行間隔の構成
- GC Failure OPM: 失敗したGC関連操作の数
- Delete Range Failure OPM: `Delete Range` が失敗した回数
- Too Many Locks Error OPM: GCがあまりにも多くのロックをクリアするエラーの数
- Action Result OPM: GC関連操作の結果の数
- Delete Range Task Status: `Delete Range` のタスクの状態。完了および失敗を含む
- Push Task Duration 95: GCサブタスクをGCワーカーにプッシュする時間

### バッチクライアント

- TiKVごとの保留中リクエスト数: 処理保留中のバッチメッセージの数
- バッチクライアント使用不可Duration 95: バッチクライアントの使用不可時間
- 利用可能な接続がない回数: バッチクライアントが利用可能なリンクを見つけられなかった回数

### TTL

- TiDB CPU使用率: 各TiDBインスタンスのCPU使用率
- TiKV IO MBps: 各TiKVインスタンスのI/Oトータルバイト数
- TiKV CPU: 各TiKVインスタンスのCPU使用率
- タイプ別TTL QPS: TTLジョブで生成された異なるタイプのステートメントのQPS情報
- TTLテーブルに挿入された行数/秒: 秒ごとにTTLテーブルに挿入された行数
- TTLジョブによって処理された行数/秒: TTLジョブによって処理された期限切れの行数/秒
- TTLテーブルに挿入された行数/時間: TTLテーブルに1時間ごとに挿入された行数
- TTLジョブによって削除された行数/時間: TTLジョブによって1時間ごとに削除された期限切れの行数
- TTLスキャン/削除クエリのDuration: TTLスキャン/削除ステートメントの実行時間
- TTLスキャン/削除ワーカーのフェーズごとの実行時間: TTLの内部ワーカースレッドの異なるフェーズで消費される時間
- 実行中のTTLジョブ数: 現在実行中のTTLジョブの数
- 実行中のTTLタスク数: 現在実行中のTTLタスクの数