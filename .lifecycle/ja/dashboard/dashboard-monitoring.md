---
title: TiDBダッシュボードモニタリングページ
summary: TiDBダッシュボード上のパフォーマンス概要ダッシュボードを表示し、パフォーマンス概要ダッシュボードに表示される主要なメトリクスを理解する方法について学びます。

# TiDBダッシュボードモニタリングページ

監視ページでは、TiDB v6.1.0で導入された性能分析およびチューニングツールであるパフォーマンス概要ダッシュボードを表示できます。パフォーマンス概要ダッシュボードを使用すると、パフォーマンスを効率的に分析し、ユーザー応答時間のボトルネックがデータベース内にあるかどうかを確認できます。ボトルネックがデータベースにある場合、データベース内でボトルネックを特定できます。その際、データベース時間の概要、ワークロードプロファイル、およびSQLレイテンシの分解が表示されます。詳細については、[パフォーマンス分析とチューニング](/performance-tuning-methods.md)を参照してください。

## ページへのアクセス

TiDBダッシュボードにログインし、左側のナビゲーションバーから**Monitoring**をクリックします。すると、パフォーマンス概要ダッシュボードが表示されます。

![Monitoring page](/media/dashboard/dashboard-monitoring.png)

TiUPを使用してTiDBクラスターを展開した場合、Grafana上でもパフォーマンス概要ダッシュボードを表示できます。この展開モードでは、監視システム（Prometheus & Grafana）が同時に展開されます。詳細については、[TiDBモニタリングフレームワークの概要](/tidb-monitoring-framework.md)を参照してください。

![performance overview](/media/performance/grafana_performance_overview.png)

## パフォーマンス概要の主要なメトリクス

パフォーマンス概要ダッシュボードは、TiDB、PD、およびTiKVのメトリクスを編成し、それぞれを以下のセクションで表示します。

- 概要: データベース時間とSQL実行時間の要約。概要の異なる色を確認することで、データベースのワークロードプロファイルとパフォーマンスのボトルネックを迅速に特定できます。

- ロードプロファイル: データベースのQPS、接続情報、アプリケーションがTiDBと対話する際のMySQLコマンドのタイプ、データベース内部のTSOやKVリクエストOPS、TiKVおよびTiDBのリソース使用状況など、主要なメトリクスとリソース使用状況。

- 上位のレイテンシ分解: クエリのレイテンシ対接続アイドル時間の比率、クエリのレイテンシ分解、実行中のTSO/KVリクエストのレイテンシ、TiKV内の書き込みレイテンシの分解。

以下のセクションでは、パフォーマンス概要ダッシュボードのメトリクスについて説明します。

### SQLタイプ別データベース時間

- データベース時間: 1秒あたりの合計データベース時間
- sql_type: 1秒あたりの各種類のSQLステートメントによって消費されるデータベース時間

### SQLフェーズ別データベース時間

- データベース時間: 1秒あたりの合計データベース時間
- get token/parse/compile/execute: 4つのSQL処理フェーズで消費されるデータベース時間

一般的に、SQL実行フェーズは緑色で、その他のフェーズは赤色です。非緑色の範囲が大きい場合、実行フェーズ以外のフェーズで多くのデータベース時間が消費され、さらなる分析が必要です。

### SQL実行時間の概要

- 実行時間: SQL実行中に消費されるデータベース時間
- tso_wait: SQL実行中における並行TSOの待ち時間1秒あたり
- kvリクエストタイプ: SQL実行中における各KVリクエストタイプごとの1秒あたりの待ち時間。総KVリクエスト待ち時間はSQL実行時間を超過する場合があります。なぜなら、KVリクエストは並行して行われるためです。

緑色のメトリクスは一般的なKVライトリクエスト（例: プリライトおよびコミット）を示し、青色のメトリクスは一般的なリードリクエストを示し、その他の色のメトリクスは注目すべき予期しない状況を示します。例えば、悲観的ロックKVリクエストが赤色でマークされ、TSO待機が濃い茶色でマークされます。

非青色または非緑色の範囲が大きい場合、SQL実行中にボトルネックがあることを意味します。

- 深刻なロックの競合が発生する場合、赤色の範囲が大きくなります。
- TSOの待機時間が過剰な場合、濃い茶色の範囲が大きくなります。

### QPS

すべてのTiDBインスタンスで実行されたSQLステートメントの1秒あたりの実行回数。`SELECT`、`INSERT`、`UPDATE`などのタイプ別で集計されます。

### タイプ別CPS

タイプ別に基づいてすべてのTiDBインスタンスが処理したコマンドの1秒あたりの実行回数。

### プランキャッシュOPSを使用するクエリ

すべてのTiDBインスタンスで1秒あたりにプランキャッシュを使用するクエリの数。

### KV/TSOリクエストOPS

- kvリクエストtotal: すべてのTiDBインスタンスでの1秒あたりの総KVリクエスト数
- kvリクエストby type: すべてのTiDBインスタンスでのKVリクエストのタイプごとの1秒あたりのリクエスト数（例: `Get`、`Prewrite`、`Commit`）
- tso - cmd: すべてのTiDBインスタンスでの`TSO cmd`リクエストの1秒あたりの数
- tso - request: すべてのTiDBインスタンスでの`TSO request`リクエストの1秒あたりの数

一般的に、`tso - cmd`を`tso - request`で除算することで、リクエストの平均バッチサイズが得られます。

### 接続数

- total: すべてのTiDBインスタンスへの接続数
- アクティブ接続: すべてのTiDBインスタンスへのアクティブ接続数
- 各TiDBインスタンスへの接続数

### TiDB CPU

- avg: すべてのTiDBインスタンスにおける平均CPU利用率
- delta: すべてのTiDBインスタンスの最大CPU利用率から最小CPU利用率を引いた値
- max: すべてのTiDBインスタンスにおける最大CPU利用率

### TiKV CPU/IO MBps

- CPU-Avg: すべてのTiKVインスタンスの平均CPU利用率
- CPU-Delta: すべてのTiKVインスタンスの最大CPU利用率から最小CPU利用率を引いた値
- CPU-MAX: すべてのTiKVインスタンスにおける最大CPU利用率
- IO-Avg: すべてのTiKVインスタンスの平均MBps
- IO-Delt: すべてのTiKVインスタンスの最大MBpsから最小MBpsを引いた値
- IO-MAX: すべてのTiKVインスタンスにおける最大MBps

### 実行時間

- 実行時間: 実行時間

    - クライアントからTiDBにリクエストを受け取り、TiDBがリクエストを実行してクライアントに結果を返すまでの時間。一般に、クライアントリクエストはSQLステートメントの形で送信されますが、この期間には`COM_PING`、`COM_SLEEP`、`COM_STMT_FETCH`、`COM_SEND_LONG_DATA`などのコマンドの実行時間も含まれます。
    - TiDBはマルチクエリをサポートしており、クライアントは一度に複数のSQLステートメントを送信できます（例: `select 1; select 1; select 1;`）。この場合、このクエリの合計実行時間にはすべてのSQLステートメントの実行時間が含まれます。

- avg: すべてのリクエストの実行時間の平均時間
- 99: すべてのリクエストのP99実行時間
- タイプ別avg: タイプ別に集計されたすべてのTiDBインスタンスでのすべてのリクエストの実行時間の平均時間（`SELECT`、`INSERT`、`UPDATE`など）

### 接続アイドル時間

接続アイドル時間は、接続がアイドル状態である期間を示します。

- avg-in-txn: トランザクション内で接続がアイドル状態である場合の平均接続アイドル時間
- avg-not-in-txn: トランザクション内で接続がアイドル状態でない場合の平均接続アイドル時間
- 99-in-txn: トランザクション内で接続がアイドル状態である場合のP99接続アイドル時間
- 99-not-in-txn: トランザクション内で接続がアイドル状態でない場合のP99接続アイドル時間

### 解析時間、コンパイル時間、および実行時間

- 解析時間: SQLステートメントの解析に要する時間
- コンパイル時間: 解析されたSQL ASTを実行プランにコンパイルするのに要する時間
- 実行時間: SQLステートメントの実行プランの実行に要する時間

これらの3つのメトリクスにはすべてのTiDBインスタンスでの平均時間とP99時間が含まれます。

### 平均TiDB KVリクエスト時間

すべてのTiDBインスタンスでのKVリクエストのタイプごとに集計したすべてのTiDBインスタンスにおける平均時間（`Get`、`Prewrite`、`Commit`など）に要する時間。

### 平均TiKV GRPCリクエスト時間

すべてのTiKVインスタンスでのGRPCリクエストのタイプごとに集計したすべてのTiKVインスタンスにおける平均時間（`kv_get`、`kv_prewrite`、`kv_commit`など）に要する時間。

### PD TSO待ち/RPCリクエスト時間

- wait - avg: すべてのTiDBインスタンスでPDがTSOを返すのを待つ平均時間
- rpc - avg: すべてのTiDBインスタンスでPDにTSOリクエストを送信してTSOを受信する平均時間
- wait - 99: すべてのTiDBインスタンスでPDがTSOを返すのを待つP99時間
- rpc - 99: すべてのTiDBインスタンスでPDにTSOリクエストを送信してTSOを受信するP99時間

### ストレージ非同期書き込み時間、ストア時間、および適用時間

- ストレージ非同期書き込み時間: 非同期書き込みに要する時間
- ストア時間: 非同期書き込みのストアループに要する時間
- 適用時間: 非同期書き込みの適用ループに要する時間

これらの3つのメトリクスにはすべてのTiKVインスタンスでの平均時間とP99時間が含まれます。

平均ストレージ非同期書き込み時間 = 平均ストア時間 + 平均適用時間

### ログの追加時間、ログのコミット時間、およびログアプライ時間

- ログの追加時間: Raftがログを追加するのに要する時間
- ログのコミット時間: Raftがログをコミットするのに要する時間
- ログアプライ時間: Raftがログを適用するのに要する時間

これらの3つのメトリクスにはすべてのTiKVインスタンスでの平均時間とP99時間が含まれます。