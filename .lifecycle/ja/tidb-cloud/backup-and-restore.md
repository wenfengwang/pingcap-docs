---
title: TiDB専用データのバックアップとリストア
summary: TiDB専用クラスタのバックアップとリストア方法について学ぶ
aliases: ['/tidbcloud/restore-deleted-tidb-cluster']
---

# TiDB専用データのバックアップとリストア

本書では、TiDB Cloud上でTiDB専用クラスタデータのバックアップとリストア方法について説明します。

> **ヒント:**
>
> TiDB Serverlessクラスタデータのバックアップとリストア方法については、[TiDB Serverlessデータのバックアップとリストア](/tidb-cloud/backup-and-restore-serverless.md)を参照してください。

## 制限事項

- TiDB Cloudは`mysql`スキーマのテーブル、ユーザー権限、システム変数の復元をサポートしていません。
- PITR（時間指定リカバリ）を何度も有効化/無効化すると、最新のPITRが有効になった後に回復可能な範囲内でのみ時間指定ポイントを選択することができます。以前の回復可能範囲はアクセスできません。

## バックアップ

TiDB専用は自動バックアップと手動バックアップをサポートしています。

自動バックアップは、バックアップ設定に応じてTiDB専用クラスタの定期的なバックアップを行い、極端な災害状況における損失を軽減します。また、バックアップスナップショットを選択して任意のタイミングで新しいTiDB専用クラスタにリストアすることもできます。

### 自動バックアップ

自動バックアップにより、設定したバックアップ時刻に従ってTiDB専用クラスタデータを毎日バックアップできます。バックアップ時刻を設定するには、以下の手順を実行してください：

1. TiDB専用クラスタの**バックアップ**ページに移動します。

2. **バックアップ設定**をクリックします。設定ウィンドウが表示されます。

3. 設定ウィンドウで自動バックアップを構成します：

    - **自動バックアップ**スイッチを**オン**に切り替えます。

    - **バックアップサイクル**では、**毎日**または**毎週**のチェックボックスを選択します。**毎週**を選択する場合は、バックアップを行う曜日を指定する必要があります。

    - **バックアップ時刻**で、毎日または毎週のクラスタバックアップの開始時刻をスケジュールします。

        自動バックアップは、ワークロードの少ない時間帯に設定することをお勧めします。希望のバックアップ時刻を指定しない場合、TiDB Cloudはデフォルトのバックアップ時刻（クラスタの所在地域の時間帯で午前2:00）を割り当てます。

    - **バックアップ保持**で、最小のバックアップデータ保持期間を構成します。

    - PITR（時間指定リカバリ）機能の有効化/無効化を行います。

        > **注意:**
        >
        > - PITR機能はデフォルトで有効になっており、毎週バックアップを有効化した場合は無効化できません。
        > - バックアップサイクルを週次から毎日に変更した場合、PITR機能は有効のままです。必要に応じて手動で無効化することができます。

    - **バックアップストレージ地域**で、バックアップデータを保存したい地域を選択します。

        TiDB Cloudはデフォルトでクラスタの現在地域にバックアップデータを保存します。この動作は変更できません。また、リモート地域を追加することで、新しいバックアップデータを自動的にリモート地域にコピーし、データの安全性と迅速なリカバリを支援します。バックアップデータ保存のリモート地域を追加した後は、その地域を削除することはできません。

4. **確認**をクリックして構成変更内容をプレビューします。

    PITRを有効にした場合、**即時バックアップを実行し、PITRの復元開始時点として使用する**チェックボックスを選択できます。それ以外の場合は、PITRは次のバックアップが完了するまで利用できません。

5. **確認**をクリックします。

### バックアップストレージ地域のサポート

現在、任意のリモート地域をバックアップデータのストレージ先として選択することはできません。現在サポートされている地域は次のとおりです：

| クラウドプロバイダ | クラスタ地域                      | リモート地域のサポート   |
|----------------|-----------------------------|--------------------------|
| Google Cloud            | Tokyo (asia-northeast1)     | Osaka (asia-northeast2)  |

> **注意:**
>
> 複数のバックアップストレージ地域を選択すると、クラスタ地域から各目的地リージョンへのバックアップデータ複製にかかる費用がかかります。費用はリージョンごとにかかり、選択したバックアップ地域によって異なります。詳細については、[データバックアップ費用](https://www.pingcap.com/tidb-cloud-pricing-details/#backup-storage-cost)を参照してください。

### 手動バックアップ

手動バックアップは、ユーザーがイニシエートするバックアップであり、必要に応じてデータを既知の状態にバックアップし、それをいつでも復元することを可能にします。

TiDB専用クラスタに手動バックアップを適用するための手順は次のとおりです：

1. クラスタの**バックアップ**タブに移動します。

2. **手動バックアップ**をクリックします。設定ウィンドウが表示されます。

3. **名前**を入力します。

4. **確認**をクリックします。そうするとクラスタデータがバックアップされます。

### バックアップファイルの削除

既存のバックアップファイルを削除するには、次の手順を実行します：

1. クラスタの**バックアップ**タブに移動します。

2. 削除したいバックアップファイルの**削除**をクリックします。

### 実行中のバックアップジョブの削除

実行中のバックアップジョブを削除するには、 [**バックアップファイルの削除**](#バックアップファイルの削除) と同様の手順を実行します。

1. クラスタの**バックアップ**タブに移動します。

2. **ペンディング**または**実行中**状態のバックアップファイルの**削除**をクリックします。

### バックアップのベストプラクティス

- ビジネスへの影響を最小限に抑えるために、クラスタがアイドル状態でバックアップ操作を実行することをお勧めします。
- データのインポート中またはクラスタスケーリング中は手動バックアップを実行しないでください。
- クラスタを削除した後、既存の手動バックアップファイルは手動で削除するか、アカウントが閉じられるまで保持されます。自動バックアップファイルはクラスタ削除日から31日間保持されます。バックアップファイルはそれに応じて削除する必要があります。

## リストア

TiDB専用は、次の2種類のデータリストアを提供しています：

- バックアップデータを新しいクラスタにリストアする
- ゴミ箱から削除されたクラスタをリストアする

### 新しいクラスタにデータをリストアする

バックアップからTiDB専用クラスタデータを新しいクラスタにリストアする手順は次のとおりです：

1. クラスタの**バックアップ**タブに移動します。

2. **リストア**をクリックします。設定ウィンドウが表示されます。

3. **リストアモード**では、任意のタイミングのデータまたは選択したバックアップを新しいクラスタにリストアできます。

    <SimpleTab>
    <div label="時間ポイントを選択">

    バックアップ保持期間内の任意の時間ポイントのデータを新しいクラスタにリストアするためには、**バックアップ設定**の**PITR**がオンになっていることを確認し、次の手順を実行します：

    1. **時間ポイントを選択**をクリックします。
    2. リストアしたい**日付**と**時刻**を選択します。

    </div>

    <div label="バックアップ名を選択">

    特定のバックアップを新しいクラスタにリストアするには、次の手順を実行します：

    1. **バックアップ名を選択**をクリックします。
    2. リストアしたいバックアップを選択します。

    </div>
    </SimpleTab>

4. **リストア先地域**には、**バックアップ設定**で構成された**バックアップストレージ地域**と同じ地域を選択します。

5. **リストア**ウィンドウでは、必要に応じて以下の変更を行うこともできます：

    - クラスタ名を設定します。
    - クラスタのポート番号を更新します。
    - クラスタのノード数、vCPU、RAM、ストレージを増やします。

6. **リストア**をクリックします。

   クラスタのリストアプロセスが開始され、**セキュリティ設定**ダイアログボックスが表示されます。

7. **セキュリティ設定**ダイアログボックスでは、ルートパスワードとクラスタへの接続を許可するIPアドレスを設定し、**適用**をクリックします。

### 削除されたクラスタをリストアする

ゴミ箱から削除されたクラスタをリストアする手順は次のとおりです：

1. [TiDB Cloudコンソール](https://tidbcloud.com)にログインします。
2. 左下隅の<MDSvgIcon name="icon-left-projects" />をクリックし、複数のプロジェクトがある場合は対象のプロジェクトに切り替え、**プロジェクト設定**をクリックします。
3. プロジェクトの**プロジェクト設定**ページで、左側のナビゲーションペインで**ゴミ箱**をクリックし、リストアしたいクラスタを見つけ、**アクション**列の**バックアップ**をクリックします。
4. 適切なバックアップ時間を探し、**アクション**列の**リストア**をクリックします。
5. **リストア**ウィンドウで、必要に応じて以下の変更を行います：

    - クラスタのポート番号を更新します。
    - クラスタのノード数、vCPU、RAM、ストレージを増やします。

6. **確認**をクリックします。

   クラスタのリストアプロセスが開始され、**セキュリティ設定**ダイアログボックスが表示されます。

7. **セキュリティ設定**ダイアログボックスで、ルートパスワードとクラスタへの接続を許可するIPアドレスを設定し、**適用**をクリックします。

> **注意:**
>
> 削除されたクラスタを任意の時間にリストアすることはできません。自動または手動バックアップを選択してリストアすることができます。