---
title: エンドポイントの管理
summary: TiDB Cloud コンソールの Data App でエンドポイントを作成、開発、テスト、デプロイ、削除する方法を学びます。

# エンドポイントの管理

データサービス（ベータ版）のエンドポイントは、SQL ステートメントを実行するためにカスタマイズできる Web API です。SQL ステートメントのパラメータを指定でき、たとえば `WHERE` 句で使用される値を指定できます。クライアントがエンドポイントを呼び出し、リクエスト URL でパラメータの値を指定すると、エンドポイントは指定されたパラメータを使用して SQL ステートメントを実行し、その結果を HTTP 応答の一部として返します。

このドキュメントでは、TiDB Cloud コンソールの Data App でエンドポイントを管理する方法について説明します。

## 開始する前に

- エンドポイントを作成する前に、以下を確認してください:

    - クラスタおよび Data App を作成していること。詳細については、「[データアプリの作成](/tidb-cloud/data-service-manage-data-app.md#create-a-data-app)」を参照してください。
    - エンドポイントが対象クラスタで既に存在するデータベース、テーブル、および列が存在すること。

- エンドポイントを呼び出す前に、Data App で API キーを作成していることを確認してください。詳細については、「[API キーの作成](/tidb-cloud/data-service-api-key.md#create-an-api-key)」を参照してください。

## エンドポイントの作成

データサービスでは、エンドポイントを自動生成するか、手動で作成することができます。

> **ヒント:**
>
> Chat2Query（ベータ版）の SQL ファイルからもエンドポイントを作成できます。詳細については、「[SQL ファイルからエンドポイントを生成](/tidb-cloud/explore-data-with-chat2query.md#generate-an-endpoint-from-a-sql-file)」を参照してください。

### エンドポイントを自動生成する

TiDB Cloud Data Service では、次の手順でエンドポイントを自動的に1つ以上生成できます:

1. プロジェクトの [**データサービス**](https://tidbcloud.com/console/data-service) ページに移動します。
2. 左ペインで対象の Data App を見つけ、App 名の右の **+** をクリックして、**エンドポイントの自動生成** をクリックします。エンドポイント生成のダイアログが表示されます。
3. ダイアログで、以下を実行します:

    1. エンドポイントを生成するための対象クラスタ、データベース、およびテーブルを選択します。

        > **注記:**
        >
        > **テーブル** ドロップダウンリストには、少なくとも1つの列を持つユーザー定義のテーブルのみが表示され、システムテーブルや列定義のないテーブルは表示されません。

    2. エンドポイントの生成に使用する少なくとも1つの HTTP 操作（たとえば `GET 取得`、`POST 作成`、`PUT 更新`）を選択します。

        選択した操作ごとに、TiDB Cloud Data Service は対応するエンドポイントを生成します。バッチ操作（たとえば `POST バッチ作成`）を選択した場合、生成されたエンドポイントを使用して複数の行を単一のリクエストで操作できます。

    3. (オプション) 操作のタイムアウトとタグを構成します。生成されたすべてのエンドポイントは、後で必要に応じて変更できるように、自動的に構成されたプロパティを継承します。
    4. (オプション) **エンドポイントの自動デプロイ** オプション（デフォルトでは無効）を使用して、生成されたエンドポイントの直接デプロイを有効または無効にします。有効にすると、ドラフトのレビュープロセスがスキップされ、生成されたエンドポイントは追加の手動レビューや承認なしに直ちにデプロイされます。

4. **生成** をクリックします。

    生成されたエンドポイントがエンドポイントリストの先頭に表示されます。

5. 新しいエンドポイントの名前、SQL ステートメント、プロパティ、およびパラメータを確認します。

    - エンドポイント名: 生成されたエンドポイント名は選択したテーブル名であり、前にリクエストメソッド（たとえば `GET`、`POST`、`PUT`）が表示されます。たとえば、選択したテーブル名が `sample-table` で、選択した操作が **POST 作成** の場合、生成されたエンドポイントは `POST sample-table` と表示されます。

        - バッチ操作が選択された場合、TiDB Cloud Data Service は生成されたエンドポイント名に `_batch` を追加します。たとえば、選択したテーブル名が `sample-table` で、選択した操作が **POST バッチ作成** の場合、生成されたエンドポイントは `POST sample-table_batch` と表示されます。
        - 同じリクエストメソッドとエンドポイント名を持つエンドポイントが既に存在する場合、TiDB Cloud Data Service は生成されたエンドポイント名に `_copy` を追加します。たとえば、`sample-table_copy` のようになります。

    - SQL ステートメント: TiDB Cloud Data Service はテーブル列の仕様と選択したエンドポイント操作に応じて、生成されたエンドポイントの SQL ステートメントを自動的に書き込みます。このページの中央部にエンドポイント名をクリックすると、SQL ステートメントを表示できます。
    - エンドポイントのプロパティ: TiDB Cloud Data Service は選択に応じて、エンドポイントのパス、リクエストメソッド、タイムアウト、およびタグを自動的に構成します。このページの右側のペインにプロパティがあります。
    - エンドポイントパラメータ: TiDB Cloud Data Service は生成されたエンドポイントのパラメータを自動的に構成します。このページの右側のペインにパラメータがあります。

6. 生成されたエンドポイントの詳細（名前、SQL ステートメント、プロパティ、パラメータなど）を変更する場合は、[エンドポイントの開発](#deploy-an-endpoint)で提供された手順を参照してください。

### エンドポイントを手動で作成する

エンドポイントを手動で作成するには、以下の手順を実行します:

1. プロジェクトの [**データサービス**](https://tidbcloud.com/console/data-service) ページに移動します。
2. 左ペインで対象の Data App を見つけ、App 名の右の **+** をクリックして、**エンドポイントの作成** をクリックします。
3. デフォルトの名前を必要に応じて更新します。新たに作成されたエンドポイントがエンドポイントリストの先頭に追加されます。
4. [エンドポイントの開発](#develop-an-endpoint)の手順に従って新しいエンドポイントを構成します。

## エンドポイントの開発

各エンドポイントについて、TiDB クラスタで実行する SQL ステートメントを記述したり、SQL ステートメントのためのパラメータを定義したり、名前やバージョンを管理したりすることができます。

> **注記:**
>
> Data App が **自動同期およびデプロイ** が有効な状態で GitHub に接続されている場合、GitHub を使用してエンドポイントの構成を更新することもできます。GitHub で行った変更は、TiDB Cloud Data Service に自動的にデプロイされます。詳細については、「[GitHub を使用した自動デプロイ](/tidb-cloud/data-service-manage-github-connection.md)」を参照してください。

### プロパティの構成

エンドポイント詳細ページの右側のペインで、**プロパティ** タブをクリックしてエンドポイントのプロパティを表示および構成することができます。

#### 基本プロパティ

- **パス**: ユーザーがエンドポイントにアクセスするために使用するパス。

    - リクエストメソッドとパスの組み合わせは Data App 内で一意である必要があります。
    - パスには英字、数字、アンダースコア（`_`）、およびスラッシュ（`/`）のみが許可されます。パスはスラッシュ（`/`）で始まり、英字、数字、またはアンダースコア（`_`）で終了する必要があります。例: `/my_endpoint/get_id`。
    - パスの長さは64文字以下である必要があります。

- **エンドポイント URL**: (読み取り専用) URL は、対応するクラスタのリージョン、Data App のサービス URL、およびエンドポイントのパスに基づいて自動的に生成されます。たとえば、エンドポイントのパスが `/my_endpoint/get_id` の場合、エンドポイント URL は `https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/my_endpoint/get_id` となります。

- **リクエストメソッド**: エンドポイントの HTTP メソッド。次のメソッドがサポートされています:

    - `GET`: データのクエリや取得に使用します。たとえば `SELECT` ステートメントなど。
    - `POST`: データの挿入や作成に使用します。たとえば `INSERT` ステートメントなど。
    - `PUT`: データの更新や変更に使用します。たとえば `UPDATE` ステートメントなど。
    - `DELETE`: データの削除に使用します。たとえば `DELETE` ステートメントなど。

- **説明** (オプション): エンドポイントの説明。

#### 上級者向けプロパティ

- **タイムアウト（ミリ秒）**: エンドポイントのタイムアウト時間（ミリ秒単位）。
- **最大行数**: エンドポイントが操作または返すことができる最大行数。
- **タグ**: エンドポイントのグループを識別するためのタグ。
- **ページネーション**: このプロパティは、リクエストメソッドが `GET` であり、エンドポイントの最後の SQL ステートメントが `SELECT` 操作の場合にのみ使用できます。**ページネーション** が有効になっている場合、エンドポイントを呼び出す際に `page` および `page_size` をクエリパラメータとして指定することで結果をページ分割できます。たとえば `https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/my_endpoint/get_id?page=<ページ番号>&page_size=<ページサイズ>`。詳細については、「[エンドポイントの呼び出し](#call-an-endpoint)」を参照してください。

    > **注記:**
    >
    > - リクエストで `page` と `page_size` パラメータを含めない場合、デフォルト動作は **最大行数** プロパティで指定された最大行数を1ページに含めて返します。
    > - `page_size` は **最大行数** プロパティ以下である必要があります。そうでない場合はエラーが返されます。

- **応答のキャッシュ**: このプロパティは、リクエストメソッドが `GET` の場合のみ使用できます。**応答のキャッシュ** が有効になっている場合、TiDB Cloud Data Service は `GET` リクエストで返された応答を指定された有効期間（TTL）内にキャッシュすることができます。
- **Time-to-live (s)**: このプロパティは、**Cache Response**が有効な場合にのみ利用可能です。キャッシュしたレスポンスのための秒単位の有効期間（TTL）を指定するために使用できます。TTL期間中に同じ `GET` リクエストを行う場合、データサービスはターゲットデータベースからデータを再度取得せずに、キャッシュされたレスポンスを直接返します。これにより、クエリのパフォーマンスが向上します。

- **バッチ操作**: このプロパティはリクエストメソッドが `POST`、`PUT`、または `DELETE` の場合にのみ表示されます。**バッチ操作**が有効になっているとき、1つのリクエストで複数の行に対して操作できます。たとえば、`POST` リクエストでデータの複数の行を挿入することができます。これは、エンドポイントを呼び出す際に `--data-raw` オプションにデータオブジェクトの配列を追加することで行います。

### SQL ステートメントを記述

エンドポイントの詳細ページのSQLエディタで、エンドポイントに対するSQLステートメントを記述して実行できます。また、単純に`--`に続けて指示を入力することで、AIによって自動的にSQLステートメントを生成させることもできます。

1. クラスターを選択します。

    > **注意:**
    >
    > データアプリにリンクされているクラスターのみがドロップダウンリストに表示されます。リンクされているクラスターを管理するには、[リンクされたクラスターの管理](/tidb-cloud/data-service-manage-data-app.md#manage-linked-data-sources)を参照してください。

    SQLエディタの上部で、実行したいクラスターをドロップダウンリストから選択します。その後、右ペインの**スキーマ**タブでこのクラスターのすべてのデータベースを表示できます。

2. SQLステートメントを記述します。

    データをクエリしたり変更する前に、まずSQLステートメントでデータベースを指定する必要があります。たとえば、`USE database_name;`のようにです。

    SQLエディタでは、テーブル結合クエリや複雑なクエリ、集計関数などを記述できます。また、単純に`--`に続けて指示を入力することで、AIによって自動的にSQLステートメントを生成させることもできます。

    パラメータを定義するには、SQLステートメント内で`${ID}`のように変数プレースホルダーとして挿入できます。たとえば、`SELECT * FROM table_name WHERE id = ${ID}`のようにです。その後、右ペインの**パラメータ**タブをクリックして、パラメータの定義とテスト値を変更できます。さらに詳細については、[パラメータ](#configure-parameters)を参照してください。

    > **注意:**
    >
    > - パラメータ名は大文字と小文字が区別されます。
    > - パラメータはテーブル名や列名として使用できません。

3. SQLステートメントを実行します。

    SQLステートメントでパラメータを挿入した場合は、右ペインの**パラメータ**タブでパラメータのテスト値やデフォルト値を設定しておく必要があります。そうでないと、エラーが返されます。

    SQLステートメントを実行するには、カーソルでSQLの行を選択し、**実行** > **カーソルで実行**をクリックします。

    SQLエディタですべてのSQLステートメントを実行するには、**実行**をクリックします。この場合、最後のSQLの結果のみが返されます。

    ステートメントを実行した後、ページの底部の**結果**タブでクエリの結果をすぐに確認できます。

### パラメータを設定します

エンドポイントの詳細ページの右ペインで、**パラメータ**タブをクリックしてエンドポイントで使用されるパラメータを表示および管理できます。

**定義**セクションでは、パラメータの以下のプロパティを表示および管理できます:

- パラメータ名: 名前には文字、数字、アンダースコア(`_`)のみを含めることができ、文字またはアンダースコア(`_`)で始める必要があります。リクエスト結果のページネーションに予約されている`page`および`page_size`というパラメータ名は使用しないでください。
- **必須**: パラメータがリクエストで必要かどうかを指定します。デフォルトの構成は必須ではないとなっています。
- **タイプ**: パラメータのデータ型を指定します。サポートされている値は`STRING`、`NUMBER`、`INTEGER`、および`BOOLEAN`です。`STRING`型のパラメータを使用する場合、引用符（`'`または`"`）を追加する必要はありません。たとえば、`foo`は`STRING`型のパラメータにとって有効であり、`"foo"`は`"\"foo\""`として処理されます。
- **デフォルト値**: パラメータのデフォルト値を指定します。

    - 値がパラメータのデータ型に変換できることを確認してください。それ以外の場合、エンドポイントからエラーが返されます。
    - パラメータにテスト値を設定していない場合、エンドポイントのテスト時にはデフォルト値が使用されます。

**テスト値**セクションでは、テストパラメータを表示および設定できます。これらの値はエンドポイントをテストする際のパラメータ値として使用されます。値がパラメータのデータ型に変換できることを確認してください。それ以外の場合、エンドポイントからエラーが返されます。

### バージョンを管理します

エンドポイントの詳細ページの右ペインで、**デプロイメント**タブをクリックしてエンドポイントのデプロイ済みバージョンを表示および管理できます。

**デプロイメント**タブでは、ドラフトバージョンをデプロイしたり、オンラインバージョンをアンデプロイしたりできます。

### 名前変更

エンドポイントの名前を変更するには、次の手順を実行します:

1. プロジェクトの[**Data Service**](https://tidbcloud.com/console/data-service)ページに移動します。
2. 左ペインで、対象のデータアプリの名前をクリックしてそのエンドポイントを表示します。
3. 変更したいエンドポイントを見つけ、**...** > **名前の変更**をクリックし、エンドポイントの新しい名前を入力します。

## エンドポイントのテスト

エンドポイントをテストするには、次の手順を実行します:

> **ヒント:**
>
> データアプリをPostmanにインポートしている場合、Postmanでデータアプリのエンドポイントをテストすることもできます。詳細は[Postmanでデータアプリを実行](/tidb-cloud/data-service-postman-integration.md)を参照してください。

1. プロジェクトの[**Data Service**](https://tidbcloud.com/console/data-service)ページに移動します。
2. 左ペインで、対象のデータアプリの名前をクリックしてそのエンドポイントを表示します。
3. テストしたいエンドポイントの名前をクリックして詳細を表示します。
4. (任意) エンドポイントにパラメータが含まれている場合は、テストする前にテスト値を設定する必要があります。

    1. エンドポイントの詳細ページの右側で、**パラメータ**タブをクリックします。
    2. **テスト値**セクションを展開し、パラメータのテスト値を設定します。

        パラメータのテスト値を設定しない場合、デフォルト値が使用されます。

5. 右上隅の**テスト**をクリックします。

    > **ヒント:**
    >
    > または、<kbd>F5</kbd>を押してエンドポイントをテストすることもできます。

エンドポイントをテストした後、ページの底部にてJSON形式のレスポンスを確認できます。JSONレスポンスの詳細については [エンドポイントのレスポンス](#レスポンス) を参照してください。

## エンドポイントのデプロイ

> **注意:**
>
> GitHubと**Auto Sync & Deployment**を接続し、GitHubでデータアプリの変更が行われた場合は、TiDB Cloud Data Serviceが自動的に展開されます。詳細は[GitHubで自動的にデプロイ](/tidb-cloud/data-service-manage-github-connection.md)を参照してください。

エンドポイントをデプロイするには、次の手順を実行します:

1. プロジェクトの[**Data Service**](https://tidbcloud.com/console/data-service)ページに移動します。
2. 左ペインで、対象のデータアプリの名前をクリックしてそのエンドポイントを表示します。
3. デプロイしたいエンドポイントの名前をクリックして詳細を表示します。その後、右上隅の**デプロイ**をクリックします。

    データアプリに**ドラフトのレビュー**が有効になっている場合、変更内容のレビューに基づいて変更を破棄するかどうかを選択できるダイアログが表示されます。

5. **デプロイ**をクリックして、デプロイを確認します。エンドポイントが正常にデプロイされた場合は、**エンドポイントがデプロイされました**のプロンプトが表示されます。

    エンドポイントの詳細ページの右側で、**デプロイメント**タブをクリックして、展開履歴を表示できます。

## エンドポイントの呼び出し

エンドポイントを呼び出すには、デプロイされていないドラフトバージョンまたは展開されたオンラインバージョンのいずれかにHTTPSリクエストを送信できます。

> **ヒント:**
>
> データアプリをPostmanにインポートしている場合、Postmanでデータアプリのエンドポイントを呼び出すこともできます。詳細は[Postmanでデータアプリを実行](/tidb-cloud/data-service-postman-integration.md)を参照してください。

### 必要条件

エンドポイントを呼び出す前に、APIキーを作成する必要があります。詳細については、[APIキーの作成](/tidb-cloud/data-service-api-key.md#create-an-api-key)を参照してください。

### リクエスト

TiDB Cloud Data Serviceは、エンドポイントを呼び出すためのコード例を生成します。コード例を取得する方法は次のとおりです:

1. プロジェクトの[**Data Service**](https://tidbcloud.com/console/data-service)ページに移動します。
2. 左ペインで、対象のデータアプリの名前をクリックしてそのエンドポイントを表示します。
3. 呼び出したいエンドポイントを見つけ、**...** > **コード例**をクリックします。**コード例**のダイアログボックスが表示されます。

    > **ヒント:**
    >
    > 代わりに、エンドポイント名をクリックして詳細を表示し、右上隅の**...** > **コード例**をクリックしても構いません。

4. ダイアログボックスで、呼び出しに使用する環境と認証方法を選択し、コード例をコピーします。

    > **注意:**
    >
    > - コード例は、エンドポイントのプロパティとパラメータに基づいて生成されます。
    > - 現在、TiDB Cloud Data Serviceではcurlコードの例のみを提供しています。

    - 環境: 必要に応じて**テスト環境**または**オンライン環境**を選択してください。**オンライン環境**は、エンドポイントをデプロイした後にのみ利用できます。
    - 認証方法: **ベーシック認証**または**ダイジェスト認証**を選択してください。
        - **ベーシック認証**は、APIキーをbase64エンコードされたテキストとして送信します。
        - **ダイジェスト認証**は、APIキーをより安全な暗号化された形式で送信します。

      **ダイジェスト認証**のcurlコードは**ベーシック認証**よりも、`--digest`オプションが追加されています。

    以下は、**バッチ操作**を有効にし、**ダイジェスト認証**を使用する`POST`リクエストのcurlコードのスニペットの例です。

    <SimpleTab>
    <div label="テスト環境">

    エンドポイントのドラフトバージョンを呼び出すには、`endpoint-type: draft`ヘッダを追加する必要があります:

    ```bash
    curl --digest --user '<Public Key>:<Private Key>' \
      --request POST 'https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/<Endpoint Path>' \
      --header 'content-type: application/json'\
      --header 'endpoint-type: draft'
      --data-raw '[{
        "age": "${age}",
        "career": "${career}"
    }]'
    ```

    </div>

    <div label="オンライン環境">

    オンライン環境でのコード例を確認する前に、まずエンドポイントをデプロイする必要があります。

    現在のオンラインバージョンのエンドポイントを呼び出すには、次のコマンドを使用します:

    ```bash
    curl --digest --user '<Public Key>:<Private Key>' \
      --request POST 'https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/<Endpoint Path>'
      --header 'content-type: application/json'\
      --data-raw '[{
        "age": "${age}",
        "career": "${career}"
    }]'
    ```

    </div>
    </SimpleTab>

    > **注意:**
    >
    > - リージョンのドメイン`<region>.data.tidbcloud.com`をリクエストすることで、TiDBクラスタが配置されている地域のエンドポイントに直接アクセスできます。
    > - また、リージョンを指定せずにグローバルドメイン`data.tidbcloud.com`をリクエストすることもできます。この方法では、TiDB Cloud Data Serviceはリクエストをターゲットリージョンに内部的に転送しますが、これにより追加のレイテンシが発生する可能性があります。この方法を選択する場合は、エンドポイントを呼び出す際に`--location-trusted`オプションをcurlコマンドに追加してください。

5. コード例をアプリケーションに貼り付け、必要に応じて例を編集してから実行してください。

    - `<Public Key>`および`<Private Key>`のプレースホルダをAPIキーで置き換える必要があります。詳細は[APIキーの管理](/tidb-cloud/data-service-api-key.md)を参照してください。
    - エンドポイントのリクエスト方法が`GET`であり、エンドポイントに**ページネーション**が有効になっている場合、`page=<ページ番号>`および`page_size=<ページサイズ>`の値を必要な値に更新して、結果をページ分割できます。たとえば、ページサイズが10の場合の2ページ目を取得するには、`page=2`および`page_size=10`を使用してください。
    - エンドポイントのリクエスト方法が`POST`または`PUT`の場合は、操作したいデータの行に応じて`--data-raw`オプションを入力してください。

        - **バッチ操作**が有効なエンドポイントの場合、`--data-raw`オプションは複数のデータオブジェクトの配列を受け入れるため、1つのエンドポイントで複数のデータ行を操作できます。
        - **バッチ操作**が有効でないエンドポイントの場合、`--data-raw`オプションは1つのデータオブジェクトのみを受け入れます。

    - エンドポイントのリクエスト方法が`DELETE`であり、エンドポイントに**バッチ操作**が有効な場合、curlコマンドで削除する複数の行をコンマ(`,`)で区切って使用することができます。たとえば、`/endpoint/<Endpoint Path>?id=${id1},${id2},${id3}`のように使用できます。
    - エンドポイントにパラメータが含まれている場合は、エンドポイントを呼び出す際にパラメータ値を指定してください。

### レスポンス

エンドポイントを呼び出した後に、JSON形式の応答を確認できます。詳細については[Data Serviceの応答とステータスコード](/tidb-cloud/data-service-response-and-status-code.md)を参照してください。

## エンドポイントのアンデプロイ

> **注意:**
>
> Data AppをGitHubに接続し、**自動同期とデプロイ**を有効にしている場合、このData Appのエンドポイントをアンデプロイすると、GitHub上のこのエンドポイントの構成も削除されます。

エンドポイントをアンデプロイするには、次の手順を実行します:

1. プロジェクトの[**Data Service**](https://tidbcloud.com/console/data-service)ページに移動します。
2. 左側のペインで、対象のData Appの名前をクリックしてそのエンドポイントを表示します。
3. アンデプロイしたいエンドポイントを見つけ、**...** > **アンデプロイ**をクリックします。
4. アンデプロイを確認するには、**アンデプロイ**をクリックします。

## エンドポイントの削除

> **注意:**
>
> エンドポイントを削除する前に、エンドポイントがオンラインでないことを確認してください。そうでない場合、エンドポイントは削除できません。エンドポイントをアンデプロイするには、[エンドポイントのアンデプロイ](#エンドポイントのアンデプロイ)を参照してください。

エンドポイントを削除するには、次の手順を実行します:

1. プロジェクトの[**Data Service**](https://tidbcloud.com/console/data-service)ページに移動します。
2. 左側のペインで、対象のData Appの名前をクリックしてそのエンドポイントを表示します。
3. 削除したいエンドポイントの名前をクリックし、右上隅で**...** > **削除**をクリックします。
4. 削除を確認するには、**削除**をクリックします。