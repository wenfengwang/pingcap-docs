---
title: TiDB Lightning プリチェック
summary: このドキュメントは、TiDB Lightning がデータ移行タスクを実行する前に行うチェックについて説明しています。これらのプリチェックにより、TiDB Lightning がタスクをスムーズに実行できることが保証されます。

# TiDB Lightning プリチェック

TiDB 5.3.0 以降、TiDB Lightning は移行タスクを実行する前に構成をチェックする機能を提供します。デフォルトで有効になっています。この機能により、ディスクスペースや実行構成のいくつかのルーチンなチェックが自動的に実行されます。主な目的は、後続のインポートプロセスがスムーズに進行することを保証することです。

次の表は各チェック項目と詳細な説明を示しています。

| チェック項目 | サポートされるバージョン| 説明 |
|  ----  | ----  |----  |
| クラスターバージョンとステータス | >= 5.3.0 | 構成でクラスターに接続でき、TiKV/PD/TiFlashのバージョンが物理的なインポートモードをサポートしているかどうかを確認します。 |
| 権限 | >= 5.3.0 | データソースがクラウドストレージ（Amazon S3）の場合、TiDB Lightning が必要な権限を持っているかどうかをチェックし、権限の不足によるインポートの失敗を防ぎます。 |
| ディスクスペース | >= 5.3.0 | ローカルディスクとTiKVクラスターのインポート用の十分なスペースがあるかどうかをチェックします。TiDB Lightning はデータソースをサンプリングし、サンプル結果からインデックスのサイズの割合を見積もります。インデックスを含んだ見積もりなので、ソースデータのサイズがローカルディスクの利用可能なスペースよりも少ない場合でも、チェックが失敗する可能性があります。物理的なインポートモードでは、TiDB Lightning は外部ソートをローカルで行うためにローカルストレージが十分かどうかも確認します。TiKVクラスタースペースとローカルストレージスペースの詳細については、[Downstream storage space requirements](/tidb-lightning/tidb-lightning-requirements.md#storage-space-of-the-target-database) と [Resource requirements](/tidb-lightning/tidb-lightning-physical-import-mode.md#environment-requirements) を参照してください。 |
| リージョン分布のステータス | >= 5.3.0 | TiKVクラスターのリージョンが均等に分散しているかどうか、空のリージョンが過剰に存在しないかをチェックします。空のリージョンの数が max(1000, テーブルの数 * 3) を超える場合（つまり "1000" または "テーブルの数の3倍" のどちらか大きい方）、インポートを実行できません。 |
| バックアップファイル内の極めて大きなCSVファイル | >= 5.3.0 | バックアップファイルに10 GiB を超えるCSVファイルがあり、自動スライシングが有効になっていない場合（StrictFormat=false）、これがインポートのパフォーマンスに影響を与えます。このチェックの目的は、データが正しい形式であることを確認し、自動スライシングを有効にするように警告することです。 |
| ブレークポイントからのリカバリ | >= 5.3.0 | このチェックは、ブレークポイントリカバリプロセス中にソースファイルやデータベースのスキーマに変更が加えられないことを確認し、誤ったデータがインポートされることを防ぎます。 |
| 既存のテーブルへのインポート | >= 5.3.0 | 既に作成されたテーブルにインポートする場合、可能な限りソースファイルが既存のテーブルに一致するかどうかをチェックします。列の数が一致するかどうかを確認します。ソースファイルに列名がある場合は、列名が一致するかどうかをチェックします。ソースファイルにデフォルト列がある場合、デフォルト列にデフォルト値があるかどうかをチェックし、ある場合はチェックが合格します。 |
| ターゲットテーブルが空であるかどうか | >= 5.3.1 | ターゲットテーブルが空でない場合、TiDB Lightning は自動的にエラーで終了します。並列インポートモードが有効になっている場合（`parallel-import = true`）、このチェック項目はスキップされます。 |