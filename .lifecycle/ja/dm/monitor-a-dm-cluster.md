---
title: データ移行モニタリングメトリクス
summary: データ移行時のモニタリングメトリクスについて学びます。
aliases: ['/docs/tidb-data-migration/dev/monitor-a-dm-cluster/']
---

# データ移行モニタリングメトリクス

DMクラスタがTiUPを使用して展開されている場合、[モニタリングシステム](/dm/migrate-data-using-dm.md#step-8-monitor-the-task-and-check-logs) も同時に展開されます。本書類では、DM-worker が提供するモニタリングメトリクスについて説明します。

## タスク

Grafana ダッシュボードにおいて、DM のデフォルト名は `DM-task` です。

### `概要`

`概要` には、現在選択されているタスクのすべての DM-worker および DM-master インスタンスまたはソースのモニタリングメトリクスが含まれています。現在のデフォルトの警告規則は、単一の DM-worker/DM-master インスタンス/ソースに対するみです。

| メトリック名 | 説明 | 警告 | 重要度レベル |
|:----|:------------|:----|:----|
| タスクの状態 | 移行のサブタスクの状態 | N/A | N/A |
| ストレージ容量 | リレーログによって占有されるディスクの総ストレージ容量 | N/A | N/A |
| 残されたストレージ | リレーログによって占有されるディスクの残りのストレージ容量 | N/A | N/A |
| マスターとリレー間のバイナリログファイルの間隔 | `relay` 処理ユニットがアップストリームマスターから遅れているバイナリログファイルの数 | N/A | N/A |
| ロード進捗 | ロードユニットの完了したロード処理のパーセンテージ。値の範囲は0%〜100% | N/A | N/A |
| マスターとシンカー間のバイナリログファイルの間隔 | `syncer` 処理ユニットがアップストリームマスターから遅れているバイナリログファイルの数 | N/A | N/A |
| シャードロック解決 | 現在のサブタスクがシャーディング DDL 移行を待機しているかどうか。値が0より大きい場合、現在のサブタスクがシャーディング DDL 移行を待機していることを示します | N/A | N/A |

### 操作エラー

| メトリック名 | 説明 | 警告 | 重要度レベル |
|:----|:------------|:----|:----|
| 任意のオペレート前のエラー | 任意のオペレーションの前のエラー数 | N/A | N/A |
| ソースバウンドエラー | データソースのバインディング操作のエラー数 | N/A | N/A |
| 開始エラー | サブタスクの開始中のエラー数 | N/A | N/A |
| 一時停止エラー | サブタスクの一時停止中のエラー数 | N/A | N/A |
| 再開エラー | サブタスクの再開中のエラー数 | N/A | N/A |
| 自動再開エラー | サブタスクの自動再開中のエラー数 | N/A | N/A |
| 更新エラー | サブタスクの更新中のエラー数 | N/A | N/A |
| 停止エラー | サブタスクの停止中のエラー数 | N/A | N/A |

### ハイアベイラビリティ

| メトリック名 | 説明 | 警告 | 重要度レベル |
|:----|:------------|:----|:----|
| 分/分あたりの dm-masters のリーダーコンポーネントの開始試行数 | dm-masters がリーダー関連のコンポーネントを有効にしようとする試行数 | N/A | N/A |
| 異なる状態にあるワーカーの数 | 異なる状態にある DM-workers の数 | 1時間以上オフラインになった DM-worker がいる | critical |
| ワーカーの状態 | DM-worker の状態 | N/A | N/A |
| ワーカーのイベントエラー数 | 異なる種類の DM-worker エラー数 | N/A | N/A |
| 分ごとのシャード DDL エラー数 | 分ごとの異なる種類のシャーディング DDL エラー数 | シャーディング DDL エラーが発生 | critical |
| 保留中のシャード DDL の数 | 1時間以上、保留中のシャーディング DDL 操作が存在する場合 | critical |

### タスクの状態

| メトリック名 | 説明 | 警告 | 重要度レベル |
|:----|:------------|:----|:----|
| タスクの状態 | サブタスクの状態 | サブタスクが`一時停止`の状態で20分以上続いた場合にアラートが発生 | critical |

### ダンプ/ロードユニット

以下のメトリックは、`task-mode` が `full` や `all` モードの場合にのみ表示されます。

| メトリック名 | 説明 | 警告 | 重要度レベル |
|:----|:------------|:----|:----|
| ダンプ進捗 | ダンプユニットの完了したダンププロセスのパーセンテージ。値の範囲は0%〜100% | N/A | N/A |
| ロード進捗 | ロードユニットの完了したロードプロセスのパーセンテージ。値の範囲は0%〜100% | N/A | N/A |
| チェックサム進捗 | ロードユニットがダンプを完了した後のチェックサムプロセスのパーセンテージ。値の範囲は0%〜100% | N/A | N/A |
| ロードユニットの合計バイト数 | ロードユニットによるインポートプロセスの解析、データ KV の生成、およびインデックス KV の生成で処理されるバイト数 | N/A | N/A |
| チャンク処理の期間 | ロードユニットがデータソースファイルのチャンクを処理する期間（秒単位） | N/A | N/A |
| データファイルサイズ | ロードユニットによってインポートされた完全なデータのデータファイル（`INSERT INTO` ステートメントを含む）の合計サイズ | N/A | N/A |
| ダンププロセスがエラーで終了 | ダンプユニットが DM-worker 内でエラーを検出し、終了した場合 | 即時アラート | critical |
| ロードプロセスがエラーで終了 | ロードユニットが DM-worker 内でエラーを検出し、終了した場合 | 即時アラート | critical |

### バイナリログのレプリケーション

以下のメトリックは、`task-mode` が `incremental` や `all` モードの場合にのみ表示されます。

| メトリック名 | 説明 | 警告 | 重要度レベル |
|:----|:------------|:----|:----|
| 同期する残りの時間 | `syncer` がアップストリームマスターと完全にマイグレーションする残りの時間の予測値（分単位） | N/A | N/A |
| レプリケートラグゲージ | アップストリームからダウンストリームまでのバイナリログのレプリケートラグの待ち時間（秒単位） | N/A | N/A |
| レプリケートラグヒストグラム | アップストリームからダウンストリームまでのバイナリログのレプリケートヒストグラム（秒単位）。異なる統計メカニズムのため、データは不正確になる可能性があります | N/A | N/A |
| プロセスがエラーで終了 | バイナリログレプリケーションユニットが DM-worker 内でエラーを検出し、終了した場合 | 即時アラート | critical |
| マスターとシンカーパイプラインのバイナリログファイル間のギャップ | `syncer` 処理ユニットがアップストリームマスターから遅れているバイナリログファイルの数 | アップストリームマスターより`syncer`処理ユニットのバイナリログファイルが1つを超えており、その状況が10分以上続いている場合にアラートが発生 | critical |
| リレーとシンカーパイプラインのバイナリログファイル間のギャップ | `syncer` が `relay` から遅れているバイナリログファイルの数 | `syncer` 処理ユニットが `relay` 処理ユニットからバイナリログファイルが1つを超えており、その状況が10分以上続いている場合にアラートが発生 | critical |
| バイナリログイベント QPS | 単位時間あたりに受信されるバイナリログイベントの数（スキップされる必要があるイベントを含まない） | N/A | N/A |
| スキップされるバイナリログイベント QPS | スキップする必要がある単位時間あたりのバイナリログイベントの数 | N/A | N/A |
| バイナリログイベントの読み取り時間 | バイナリログレプリケーションユニットがリレーログまたはアップストリーム MySQL からバイナリログを読み取る時間（秒単位） | N/A | N/A |
| バイナリログイベントの変換時間 | バイナリログレプリケーションユニットがバイナリログを解析し、SQL ステートメントに変換する時間（秒単位） | N/A | N/A |
| バイナリログイベントのディスパッチ時間 | バイナリログレプリケーションユニットがバイナリログイベントをディスパッチする時間（秒単位） | N/A | N/A |
| トランザクションの実行待ち時間 | バイナリログレプリケーションユニットがダウンストリームでトランザクションを実行する時間（秒単位） | N/A | N/A |
| バイナリログイベントのサイズ | バイナリログレプリケーションユニットがリレーログまたはアップストリーム MySQL から読み取るバイナリログイベントのサイズ | N/A | N/A |
| DML ジョブの残りキューの長さ | 残りの DML ジョブキューの長さ | N/A | N/A |
| 合計の SQL ジョブ数 | 単位時間あたりの新たに追加されたジョブの数 | N/A | N/A |
| 完了した SQL ジョブ数 | 単位時間あたりの完了したジョブの数 | N/A | N/A |
| ステートメント実行待ち時間 | バイナリログレプリケーションユニットがダウンストリームでステートメントを実行する時間（秒単位） | N/A | N/A |
| ジョブの追加待ち時間 | バイナリログレプリケーションユニットがジョブをキューに追加する時間（秒単位） | N/A | N/A |
| DML コンフリクト検出待ち時間 | バイナリログレプリケーションユニットが DML でコンフリクトを検出する時間（秒単位） | N/A | N/A |
| スキップされたイベントの待ち時間 | バイナリログレプリケーションユニットがバイナリログイベントをスキップする時間（秒単位） | N/A | N/A |
| 同期されていないテーブル | 現在のサブタスクでシャード DDL ステートメントを受信していないテーブルの数 | N/A | N/A |
| シャードロックの解決 | 現在のサブタスクがシャード DDL ロックの解決を待っているかどうか。値が0より大きい場合、シャード DDL ロックの解決を待っていることを示します | N/A | N/A |
| ideal QPS | DMの実行時間が0の場合に達成できる最高のQPS | N/A | N/A |
| binlog event row | binlogイベント内の行数 | N/A | N/A |
| finished transaction total | 総完了トランザクション数 | N/A | N/A |
| replication transaction batch | ダウンストリームで実行されるトランザクション内のSQL行数 | N/A | N/A |
| flush checkpoints time interval | チェックポイントをフラッシュする間隔（秒単位） | N/A | N/A |

### Relay log

> **注意:**
>
> 現在、DM v2.0では中継ログ機能の有効化がサポートされていません。

| メトリック名 | 説明 | アラート | 重要度レベル |
|:----|:------------|:----|:----|
| ストレージ容量 | 中継ログによって占有されたディスクのストレージ容量 | N/A | N/A |
| 残りのストレージ | 中継ログによって占有されたディスクの残りのストレージ容量 | 値が10G未満になった場合に警告が必要 | クリティカル |
| エラーでプロセスが終了 | 中継ログでDM-worker内でエラーが発生し、終了したケース | 直ちに警告 | クリティカル |
| 中継ログデータの破損 | 破損した中継ログファイルの数 | 直ちに警告 | 緊急 |
| マスターバイナリログの読み取りに失敗 | 中継ログがアップストリームのMySQLからバイナリログを読み取る際に遭遇したエラーの数 | 直ちに警告 | クリティカル |
| 中継ログの書き込みに失敗 | 中継ログがバイナリログをディスクに書き込む際に遭遇したエラーの数 | 直ちに警告 | クリティカル |
| バイナリログファイルインデックス | 中継ログファイルの最大インデックス番号。たとえば、"value = 1" は "relay-log.000001" を示します | N/A | N/A |
| マスターと中継ログ間のバイナリログファイルギャップ | 中継ログ内でアップストリームマスターに遅れているバイナリログファイルの数 | `relay`処理ユニットがアップストリームマスターより1つ以上のバイナリログファイルに遅れており、その状態が10分以上続いた場合に警告が発生する | クリティカル |
| バイナリログポジション | 最新の中継ログファイルの書き込みオフセット | N/A | N/A |
| バイナリログイベントの読み取り時間 | 中継ログがアップストリームのMySQLからバイナリログを読み取る時間（秒単位） | N/A | N/A |
| 中継ログの書き込み時間 | 中継ログがバイナリログをディスクに書き込む時間（秒単位） | N/A | N/A |
| バイナリログイベントのサイズ | 中継ログがディスクに書き込む単一のバイナリログイベントのサイズ | N/A | N/A |

## インスタンス

Grafana ダッシュボードでは、インスタンスのデフォルト名は `DM-instance` です。

### 中継ログ

| メトリック名 | 説明 | アラート | 重要度レベル |
|:----|:------------|:----|:----|
| ストレージ容量 | 中継ログによって占有されたディスクの合計ストレージ容量 | N/A | N/A |
| 残りのストレージ | 中継ログによって占有されたディスク内の残りのストレージ容量 | 値が10G未満になった場合に警告が発生 | クリティカル |
| エラーでプロセスが終了 | 中継ログでDM-worker内でエラーが発生し、終了したケース | 直ちに警告 | クリティカル |
| 中継ログデータの破損 | 破損した中継ログの数 | 直ちに警告 | 緊急 |
| マスターバイナリログの読み取りに失敗 | 中継ログがアップストリームのMySQLからバイナリログを読み取る際に遭遇したエラーの数 | 直ちに警告 | クリティカル |
| 中継ログの書き込みに失敗 | 中継ログがバイナリログをディスクに書き込む際に遭遇したエラーの数 | 直ちに警告 | クリティカル |
| バイナリログファイルインデックス | 中継ログファイルの最大インデックス番号。たとえば、"value = 1" は "relay-log.000001" を示します | N/A | N/A |
| マスターと中継ログ間のバイナリログファイルギャップ | `relay`処理ユニットがアップストリームマスターより遅れているバイナリログファイルの数 | `relay`処理ユニットがアップストリームマスターより1つ以上のバイナリログファイルに遅れており、その状態が10分以上続いた場合に警告が発生 | クリティカル |
| バイナリログポジション | 最新の中継ログファイルの書き込みオフセット | N/A | N/A |
| バイナリログの読み取り時間 | 中継ログがアップストリームのMySQLからバイナリログを読み取る時間（秒単位） | N/A | N/A |
| 中継ログの書き込み時間 | 中継ログがバイナリログをディスクに書き込む時間（秒単位） | N/A | N/A |
| バイナリログのサイズ | 中継ログがディスクに書き込む単一のバイナリログイベントのサイズ | N/A | N/A |

### タスク

| メトリック名 | 説明 | アラート | 重要度レベル |
|:----|:------------|:----|:----|
| タスクの状態 | マイグレーションのサブタスクの状態 | サブタスクが10分以上一時停止された場合に警告が発生 | クリティカル |
| ロード進捗 | ロードユニットの完了したロードプロセスのパーセンテージ。値の範囲は0%〜100% | N/A | N/A |
| マスターとシンカ―のバイナリログファイルギャップ | バイナリログレプリケーションユニットがアップストリームマスターより遅れているバイナリログファイルの数 | N/A | N/A |
| シャードロックの解決 | 現在のサブタスクがシャーディングDDLマイグレーションを待機しているかどうか。0を超える値は、現在のサブタスクがシャーディングDDLマイグレーションを待機していることを示します | N/A | N/A |