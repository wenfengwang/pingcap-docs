---
title: データ移行アーキテクチャ
---

# データ移行アーキテクチャ

この文書はデータ移行（DM）のアーキテクチャを紹介します。

DMには、DM-master、DM-worker、dmctlの3つのコンポーネントがあります。

![データ移行アーキテクチャ](/media/dm/dm-architecture-2.0.png)

## アーキテクチャコンポーネント

### DM-master

DM-masterはデータ移行タスクの操作を管理しスケジュールします。

- DMクラスターのトポロジ情報を保存
- DM-workerプロセスの実行状態を監視
- データ移行タスクの実行状態を監視
- データ移行タスクの管理のための統一ポータルを提供
- シャーディングシナリオ下で各インスタンスのシャードテーブルのDDL移行を調整

### DM-worker

DM-workerは特定のデータ移行タスクを実行します。

- binlogデータをローカルストレージに永続化
- データ移行サブタスクの構成情報を保存
- データ移行サブタスクの操作をまとめる
- データ移行サブタスクの実行状態を監視

DM-workerの詳細については、[DM-workerの紹介](/dm/dm-worker-intro.md)を参照してください。

### dmctl

dmctlはDMクラスターを制御するためのコマンドラインツールです。

- データ移行タスクの作成、更新、削除
- データ移行タスクの状態の確認
- データ移行タスクのエラー処理
- データ移行タスクの構成の正確性を検証

## アーキテクチャ機能

### 高可用性

複数のDM-masterノードを展開すると、すべてのDM-masterノードは組み込みetcdを使用してクラスターを形成します。DM-masterクラスターは、クラスターノード情報やタスク構成などのメタデータを格納するために使用されます。etcdによって選出されたリーダーノードは、クラスター管理やデータ移行タスク管理などのサービスを提供するために使用されます。したがって、展開されたノードの半数以上の利用可能なDM-masterノードの数があれば、DMクラスターは通常サービスを提供できます。

展開されたDM-workerノードの数が上流のMySQL/MariaDBノードの数を超えると、余分なDM-workerノードはデフォルトでアイドル状態です。DM-workerノードがオフラインになったりDM-masterリーダーから分離されたりすると、DM-masterはオリジナルのDM-workerノードのデータ移行タスクを他のアイドル状態のDM-workerノードに自動的にスケジュールします（DM-workerノードが分離された場合、それ自体のデータ移行タスクを自動的に停止します）。アイドル状態のDM-workerノードが利用可能でない場合、オリジナルのDM-workerのデータ移行タスクは一時的に保留され、DM-workerノードがアイドル状態になるまで保留された後、タスクは自動的に再開されます。

> **注意:**
>
> データ移行タスクが完全エクスポートまたはインポートのプロセス中の場合、移行タスクは高可用性をサポートしません。主な理由は次のとおりです：
>
> - 完全エクスポートの場合、MySQLはまだ特定のスナップショットポイントからのエクスポートをサポートしていません。これは、データ移行タスクが再スケジュールされたり再開されたりした後、エクスポートが前回の中断ポイントから再開できないことを意味します。
>
> - 完全インポートの場合、DM-workerはまだノード間でエクスポートされた完全なデータを読み取ることをサポートしていません。これは、データ移行タスクが新しいDM-workerノードにスケジュールされた後、スケジュールされる前のオリジナルのDM-workerノードでエクスポートされた完全なデータを読み取ることができないことを意味します。