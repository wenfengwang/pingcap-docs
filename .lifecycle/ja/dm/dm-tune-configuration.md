---
title: DMの構成を最適化する
summary: データマイグレーションのパフォーマンスを向上させるために、データマイグレーションタスクの構成を最適化する方法について学びます。
---

# DMの構成を最適化する

このドキュメントでは、データマイグレーションタスクの構成を最適化してデータマイグレーションのパフォーマンスを向上させる方法について紹介します。

## フルデータのエクスポート

`mydumpers` はフルデータのエクスポートに関連する構成項目です。このセクションでは、パフォーマンスに関連するオプションの設定方法について説明します。

### `rows`

`rows` オプションを設定すると、マルチスレッドを使用して単一のテーブルからデータを同時にエクスポートできます。 `rows` の値は、各エクスポートチャンクに含まれる最大行数です。このオプションを有効にした後、DMはMySQL単一のテーブルのデータを同時にエクスポートする際の分割基準として列を選択します。この列は、次のいずれかの列であることができます: プライマリキー列、ユニークインデックス列、および通常のインデックス列（優先度の高い順から低い順に並べ替えます）。この列は整数型であることを確認してください（たとえば、 `INT`、`MEDIUMINT`、`BIGINT`）。

`rows` の値は10000に設定できます。この値は、テーブルの総行数とデータベースのパフォーマンスに応じて変更できます。また、同時スレッドの数を制御するために `threads` を設定する必要があります。デフォルトでは、`threads` の値は4です。必要に応じてこの値を調整できます。

### `chunk-filesize`

フルバックアップ中、DMは `chunk-filesize` オプションの値に応じて各テーブルのデータを複数のチャンクに分割します。各チャンクは、おおよそ `chunk-filesize` のサイズでファイルに保存されます。これにより、データが複数のファイルに分割され、DM Loadユニットの並列処理を利用してインポート速度を向上させることができます。このオプションのデフォルト値は64（MB）です。通常はこのオプションを設定する必要はありません。設定する場合は、フルデータのサイズに応じてこのオプションの値を調整してください。

> **注意:**
>
> - マイグレーションタスクが作成された後は、 `mydumpers` の値を更新することはできません。タスクを作成する前に各オプションの値を確認してください。値を更新する必要がある場合は、dmctlを使用してタスクを停止し、構成ファイルを更新し、タスクを再作成してください。
> - `mydumpers`の `threads` は、シンプルさのために `mydumper-thread` 構成項目で置き換えることができます。
> - `rows` が設定されている場合、DMは `chunk-filesize` の値を無視します。

## フルデータのインポート

`loaders` はフルデータのインポートに関連する構成項目です。このセクションでは、パフォーマンスに関連するオプションの設定方法について説明します。

### `pool-size`

`pool-size` オプションは、DM Loadユニットのスレッド数を決定します。デフォルト値は16です。通常はこのオプションを設定する必要はありません。設定する場合は、フルデータのサイズとデータベースのパフォーマンスに応じてこのオプションの値を調整してください。

> **注意:**
>
> - マイグレーションタスクが作成された後は、 `loaders` の値を更新することはできません。タスクを作成する前に各オプションの値を確認してください。値を更新する必要がある場合は、dmctlを使用してタスクを停止し、構成ファイルを更新し、タスクを再作成してください。
> - `loaders`の `pool-size` は、シンプルさのために `loader-thread` 構成項目で置き換えることができます。

## インクリメンタルデータのレプリケーション

`syncers` はインクリメンタルデータのレプリケーションに関連する構成項目です。このセクションでは、パフォーマンスに関連するオプションの設定方法について説明します。

### `worker-count`

`worker-count` はDM Syncユニット内でのDMLの同時レプリケーションスレッド数を決定します。デフォルト値は16です。データのレプリケーションを速めるために、このオプションの値を適切に増やしてください。

### `batch`

`batch` は、DM Syncユニットで下流データベースにデータをレプリケーションする際、各トランザクションに含まれるDMLの数を決定します。デフォルト値は100です。通常はこのオプションの値を変更する必要はありません。

> **注意:**
>
> - レプリケーションタスクが作成された後は、 `syncers` の値を更新することはできません。タスクを作成する前に各オプションの値を確認してください。値を更新する必要がある場合は、dmctlを使用してタスクを停止し、構成ファイルを更新し、タスクを再作成してください。
> - `syncers`の `worker-count` は、シンプルさのために `syncer-thread` 構成項目で置き換えることができます。
> - `worker-count` および `batch` の値は、実際のシナリオに応じて変更できます。たとえば、DMと下流データベースの間でネットワーク遅延が大きい場合は、 `worker-count` の値を増やし、適切に `batch` の値を減らすことができます。