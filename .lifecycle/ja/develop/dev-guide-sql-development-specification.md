---
title: TiDB SQL開発仕様
summary: TiDBのSQL開発仕様について学びます。
---

# SQL開発仕様

このドキュメントでは、SQLの使用に関する一般的な開発仕様を紹介します。

## テーブルの作成と削除

- 基本原則: テーブルの命名規則に従いつつ、アプリケーション内でテーブルの作成と削除の文をまとめ、異常なビジネスプロセスの中断を防ぐための判定ロジックを追加することを推奨します。
- 詳細: `create table if not exists テーブル名` または `drop table if exists テーブル名` の文に `if` 判定を追加して、アプリケーション側でSQLコマンドが異常に実行されることによる異常な中断を避けることを推奨します。

## `SELECT *`の使用法

- 基本原則: クエリでは `SELECT *` の使用を避けること。
- 詳細: 必要な列を選択し、`SELECT *` を使用してすべてのフィールドを読み取ることを避ける。このような操作はネットワーク帯域幅を消費するためです。クエリされたフィールドをインデックスに追加し、カバリングインデックスを効果的に活用することを検討してください。

## フィールド上で関数を使用

- 基本原則: クエリされたフィールドに関連する関数を使用できます。インデックスの失敗を避けるために、`WHERE`句内のフィルタされたフィールドに関数を使用しないでください。これにはデータ型変換関数も含まれます。式インデックスの使用を検討してください。
- 詳細な説明:

    非推奨:

    {{< copyable "sql" >}}

    ```sql
    SELECT gmt_create
    FROM ...
    WHERE DATE_FORMAT(gmt_create, '%Y%m%d %H:%i:%s') = '20090101 00:00:00'
    ```

    推奨:

    {{< copyable "sql" >}}

    ```sql
    SELECT DATE_FORMAT(gmt_create, '%Y%m%d %H:%i:%s')
    FROM ...
    WHERE gmt_create = str_to_date('20090101 00:00:00', '%Y%m%d %H:%i:%s')
    ```

## その他の仕様

- `WHERE`条件においてインデックス列に対して数学演算または関数を実行しないでください。
- `OR`を`IN`または`UNION`で置き換えてください。 `IN`の数は300未満である必要があります。
- 曖昧なプレフィックスクエリにおいて`%`プレフィックスの使用を避けてください。
- アプリケーションが**マルチステートメント**を使用してSQLを実行する場合（すなわち、複数のSQLがセミコロンで結合され、一度にクライアントに送信され実行される場合）、TiDBは最初のSQLの実行結果のみを返します。
- 式を使用する際は、式がストレージレイヤー（TiKVまたはTiFlash）にプッシュダウンされるかどうかを確認してください。そうでない場合、メモリ消費が増加し、TiDB層でのOOMが発生する可能性があります。ストレージレイヤーにプッシュダウンできる計算は次のとおりです：
    - [TiFlashサポートプッシュダウン計算](/tiflash/tiflash-supported-pushdown-calculations.md)。
    - [TiKV - プッシュダウン用の式のリスト](/functions-and-operators/expressions-pushed-down.md)。
    - [プレディケートプッシュダウン](/predicate-push-down.md)。