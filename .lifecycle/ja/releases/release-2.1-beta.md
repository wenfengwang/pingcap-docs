---
title: TiDB 2.1 Beta リリースノート
aliases: ['/docs/dev/releases/release-2.1-beta/','/docs/dev/releases/21beta/']
---

# TiDB 2.1 Beta リリースノート

2018年6月29日、TiDB 2.1 Beta がリリースされました！このリリースは、安定性、SQLオプティマイザ、統計情報、および実行エンジンの大幅な改善がされています。

## TiDB

- SQLオプティマイザ
    - `Index Join` の選択範囲を最適化して実行パフォーマンスを向上させる
    - 相関サブクエリを最適化し、`Filter` をプッシュダウンしてインデックスの範囲を拡張し、いくつかのクエリの効率を何倍も向上させる
    - `UPDATE` と `DELETE` 文での `Index Hint` と `Join Hint` をサポート
    - 利用可能なインデックスが存在しない場合に `TIDM_SMJ` ヒントを検証
    - `ABS`、`CEIL`、`FLOOR`、`IS TRUE`、`IS FALSE` 関数のプッシュダウンをサポート
    - 定数畳み込み処理において `IF` と `IFNULL` 関数を特別扱い
- SQL実行エンジン
    - 並列 `Hash Aggregate` 演算子を実装し、あるシナリオで `Hash Aggregate` の計算パフォーマンスを350%向上
    - 並列 `Project` 演算子を実装し、あるシナリオでパフォーマンスを74%向上
    - `Hash Join` の `Inner` テーブルと `Outer` テーブルのデータを同時に読むことで実行パフォーマンスを向上
    - あるシナリオでの `INSERT … ON DUPLICATE KEY UPDATE …` の不正確な結果を修正
    - `CONCAT_WS`、`FLOOR`、`CEIL`、`DIV` 組み込み関数の不正確な結果を修正
- サーバー
    - TiKV クラスター内のテーブルリージョンの分散を散らすためのHTTP APIを追加
    - 自動 `Analyze` の閾値値を制御するための `auto_analyze_ratio` システム変数を追加
    - 一般ログをオープンするかどうかを制御するためのHTTP APIを追加
    - ログレベルをオンラインで変更するためのHTTP APIを追加
    - 一般ログや遅いクエリログにユーザー情報を追加
    - サーバーサイドカーソルをサポート
- 互換性
    - より多くのMySQL構文をサポート
    - `bit` 集約関数が `ALL` パラメータをサポート
    - `SHOW PRIVILEGES` 文をサポート
- DML
    - `INSERT INTO SELECT` 文のメモリ使用量を減らす
    - `PlanCache` のパフォーマンス問題を修正
    - トランザクションの自動リトライ回数を制御するための `tidb_retry_limit` システム変数を追加
    - トランザクションが自動的にリトライするかどうかを制御するための `tidb_disable_txn_auto_retry` システム変数を追加
    - `time` 型の書き込みデータの精度の問題を修正
    - ローカルで競合するトランザクションのキューをサポートしてトランザクションのパフォーマンスを最適化
    - `UPDATE` 文の `Affected Rows` を修正
    - `insert ignore on duplicate key update` のステートメントパフォーマンスを最適化
- DDL
    - `CreateTable` 文の実行速度を最適化
    - `ADD INDEX` の実行速度を最適化し、あるシナリオで大幅に改善
    - `Alter table add column` による追加列の数がテーブル列数の制限を超える問題を修正
    - DDL ジョブのリトライによる異常な状況下でのTiKVへの負荷増加を修正
    - 異常な状況下でTiDBが連続してスキーマ情報をリロードしない問題を修正
    - `SHOW CREATE TABLE` の結果で `FOREIGN KEY` 関連情報を出力しない
    - `select tidb_is_ddl_owner()` ステートメントをサポートし、TiDBが `DDL Owner` であるかどうかを判断するのに役立つ
    - あるシナリオでの `Year` 型におけるインデックスの削除問題を修正
    - 並行実行シナリオにおけるテーブルのリネーム問題を修正
    - `AlterTableForce` 構文をサポート
    - `FromKey` と `ToKey` を含む `AlterTableRenameIndex` 構文をサポート
    - `admin show ddl jobs` の出力情報にテーブル名とデータベース名を追加

## PD

- ネットワーク隔離後のネットワーク回復時にリーダー再選を避けるために、PDノード間でRaft PreVoteを有効にする
- バランススケジューラーが頻繁に小さなリージョンをスケジュールする問題を最適化
- トラフィック統計情報の揺らぎに対する適応性を向上するためにホットスポットスケジューラーを最適化
- `region merge` のスケジュール時に行数が多いリージョンをスキップする
- スケジュール時に発生するマシン障害によるデータ利用不可リスクを低減するために、デフォルトで `raft learner` を有効にする
- `pd-recover` から `max-replica` を削除
- `Filter` メトリクスを追加
- tikv-ctl unsafeリカバリ後にリージョン情報が更新されない問題を修正
- あるシナリオでの複製移行によるTiKVディスクスペースの使用完了問題を修正
- 互換性ノート
    - 新バージョンのストレージエンジンの更新により、v2.0.x以前へのロールバックはサポートされない
    - 新バージョンのPDではデフォルトで `raft learner` が有効になる。クラスターを1.xから2.1にアップグレードする場合、マシンはアップグレード前に停止するか、TiKVに対してローリング更新を最初に適用した後、PDに対して適用する必要がある

## TiKV

- Rustを `nightly-2018-06-14` バージョンにアップグレード
- ネットワーク隔離後のネットワーク回復時に生じるリーダー再選を避けるために `Raft PreVote` を有効にする
- RocksDBの各層でファイルと `ingest` 関連情報の数を表示するメトリックを追加
- GC作業時に多数のバージョンを持つ `key` を表示
- マルチラベルメトリックのパフォーマンスを最適化するために `static metric` を使用 (YCSB `raw get` が3%改善)
- 複数のモジュールで `box` を削除し、パターンを使用して操作のパフォーマンスを改善 (YCSB `raw get` が3%改善)
- ログ書き込みのパフォーマンスを改善するために非同期ログを使用
- スレッドステータスを収集するメトリックを追加
- アプリケーションで使用される `box` を減らすことでメモリコピー回数を減らし、パフォーマンスを向上