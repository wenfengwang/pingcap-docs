---
title: パーティション化された Raft KV
summary: TiKV のパーティション化された Raft KV 機能について学びます。
---

# パーティション化された Raft KV

> **警告:**
>
> パーティション化された Raft KV は実験的な機能です。本番環境で使用することは推奨されません。この機能は事前の予告なしに変更または削除される場合があります。バグを見つけた場合は、GitHub の [issue](https://github.com/pingcap/tidb/issues) で報告することができます。

v6.6.0 より前のバージョンでは、TiKV の Raft ベースのストレージエンジンは、TiKV インスタンスのすべてのリージョンのデータを格納するために単一の RocksDB インスタンスを使用していました。

より大規模なクラスタをより安定してサポートするために、TiDB v6.6.0 からは新しい TiKV ストレージエンジンが導入され、それぞれのリージョンのデータを独立して複数の RocksDB インスタンスに格納するようになりました。

新しいエンジンは、各 RocksDB インスタンスのファイル数とレベルをよりよく制御し、リージョン間のデータ操作を物理的に分離し、より多くのデータを安定して管理できるようになりました。この機能は、パーティション化された Raft KV と名前が付けられた理由です。これにより、TiKV はパーティション分割を通じて複数の RocksDB インスタンスを管理していると見なすことができます。

## アプリケーションシナリオ

この機能を使用できる条件は次の通りです:

* 単一の TiKV インスタンスがより多くのデータをサポートする必要があります。
* 多くの書き込みリクエストがあります。
* スケールインおよびスケールアウトの操作が頻繁に行われます。
* ワークロードに深刻な読み書き増幅があります。
* 十分なメモリを持っています。

この機能の利点は、より良い書き込みパフォーマンス、より速いスケーリング速度、および同じハードウェアでより多くのデータをサポートできることです。また、より大規模なクラスタのスケールもサポートできます。

## 使用法

パーティション化された Raft KV を有効にするには、クラスタを作成する際に構成項目 [`storage.engine`](/tikv-configuration-file.md#engine-new-in-v660) を `"partitioned-raft-kv"` に設定します。同時に、Raft KV を使用する際の RocksDB のメモリ使用量を制御するために構成項目 [`rocksdb.write-buffer-flush-oldest-first`](/tikv-configuration-file.md#write-buffer-flush-oldest-first-new-in-v660) と [`rocksdb.write-buffer-limit`](/tikv-configuration-file.md#write-buffer-limit-new-in-v660) を使用できます。

## 制限事項

パーティション化された Raft KV には、以下の制限事項があります:

* EBS ボリュームのスナップショットバックアップはまだサポートされていません。
* オンラインの不安全なリカバリや Titan はまだサポートされていません。
* `tikv-ctl` コマンドラインツールの以下のサブコマンドはサポートされていません:
    * `unsafe-recover`
    * `raw-scan`
    * `remove-fail-stores`
    * `recreate-region`
    * `reset-to-version`
* TiFlash とはまだ互換性がありません。
* クラスタが初期化された後は、この機能を有効または無効にすることはできません。