---
title: ユーザー定義変数
summary: ユーザー定義変数の使用方法を学びます。
aliases: ['/docs/dev/user-defined-variables/','/docs/dev/reference/sql/language-structure/user-defined-variables/']
---

# ユーザー定義変数

このドキュメントでは、TiDBでのユーザー定義変数の概念とその設定および読み取り方法について説明します。

> **警告:**
>
> ユーザー定義変数はまだ実験的な機能です。本番環境で使用することを**お勧めしません**。

ユーザー定義変数の形式は`@var_name`です。 `var_name`を構成する文字は、数字の`0-9`、英字の`a-zA-Z`、アンダースコア`_`、ドル記号`$`、UTF-8文字を含む識別子を構成する可能性がある任意の文字であることを含みます。さらに、英語のピリオド`.`も含まれます。 ユーザー定義変数は大文字と小文字を区別しません。

ユーザー定義変数はセッション固有であり、つまり、1つのクライアント接続で定義されたユーザー変数は、他のクライアント接続からは見えず使用できません。

## ユーザー定義変数の設定

`SET`文を使用してユーザー定義変数を設定でき、構文は `SET @var_name = expr [, @var_name = expr] ...;`です。 例:

{{< copyable "sql" >}}

```sql
SET @favorite_db = 'TiDB';
```

{{< copyable "sql" >}}

```sql
SET @a = 'a', @b = 'b', @c = 'c';
```

代入演算子では、 `:=` も使用できます。 例:

{{< copyable "sql" >}}

```sql
SET @favorite_db := 'TiDB';
```

代入演算子の右側のコンテンツは、有効な式であれば何でもかまいません。 例:

{{< copyable "sql" >}}

```sql
SET @c = @a + @b;
```

{{< copyable "sql" >}}

```sql
set @c = b'1000001' + b'1000001';
```

## ユーザー定義変数の読み取り

ユーザー定義変数を読み取るには、`SELECT`文を使用してクエリを行います:

{{< copyable "sql" >}}

```sql
SELECT @a1, @a2, @a3
```

```
+------+------+------+
| @a1  | @a2  | @a3  |
+------+------+------+
|    1 |    2 |    4 |
+------+------+------+
```

また、`SELECT`文で値を代入することもできます:

```sql
SELECT @a1, @a2, @a3, @a4 := @a1+@a2+@a3;
```

```
+------+------+------+--------------------+
| @a1  | @a2  | @a3  | @a4 := @a1+@a2+@a3 |
+------+------+------+--------------------+
|    1 |    2 |    4 |                  7 |
+------+------+------+--------------------+
```

変数`@a4`が修正されるか接続が閉じられるまで、その値は常に`7`です。

ユーザー定義変数を設定する際に16進リテラルまたはバイナリリテラルを使用する場合、TiDBはそれをバイナリ文字列として扱います。 数値に設定する場合は、`CAST`変換を手動で追加するか、式で数値演算子を使用できます:

{{< copyable "sql" >}}

```sql
SET @v1 = b'1000001';
SET @v2 = b'1000001'+0;
SET @v3 = CAST(b'1000001' AS UNSIGNED);
```

{{< copyable "sql" >}}

```sql
SELECT @v1, @v2, @v3;
```

```
+------+------+------+
| @v1  | @v2  | @v3  |
+------+------+------+
| A    | 65   | 65   |
+------+------+------+
```

初期化されていないユーザー定義変数を参照すると、NULL値と文字列型を持つことになります。

{{< copyable "sql" >}}

```sql
SELECT @not_exist;
```

```
+------------+
| @not_exist |
+------------+
| NULL       |
+------------+
```

ユーザー定義変数を読み取るための`SELECT`文の他の一般的な使用法として`PREPARE`文があります。 例:

{{< copyable "sql" >}}

```sql
SET @s = 'SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse';
PREPARE stmt FROM @s;
SET @a = 6;
SET @b = 8;
EXECUTE stmt USING @a, @b;
```

```
+------------+
| hypotenuse |
+------------+
|         10 |
+------------+
```

SQL文中ではユーザー定義変数の内容は識別子として認識されません。 例:

{{< copyable "sql" >}}

```sql
SELECT * from t;
```

```
+---+
| a |
+---+
| 1 |
+---+
```

{{< copyable "sql" >}}

```sql
SET @col = "`a`";
SELECT @col FROM t;
```

```
+------+
| @col |
+------+
| `a`  |
+------+
```

## MySQLの互換性

`SELECT ... INTO <variable>`を除いて、MySQLとTiDBでサポートされている構文は同じです。

詳細は、[MySQLのユーザー定義変数](https://dev.mysql.com/doc/refman/8.0/en/user-variables.html)を参照してください。