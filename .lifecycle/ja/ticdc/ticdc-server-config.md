---
title: TiCDCサーバーの設定
summary: TiCDCで使用されるCLIと構成パラメータの学習
---

# TiCDCサーバーの設定

このドキュメントでは、TiCDCで使用されるCLIと構成ファイルのパラメータについて説明します。

## `cdc server` CLIパラメータ

以下に、`cdc server`コマンドで使用可能なオプションの説明を示します：

- `addr`: TiCDCのリスニングアドレス、HTTP APIアドレス、およびTiCDCサービスのPrometheusアドレスです。デフォルト値は`127.0.0.1:8300`です。
- `advertise-addr`: クライアントがTiCDCにアクセスするための公開アドレスです。未指定の場合、値は`addr`と同じです。
- `pd`: PDエンドポイントのカンマ区切りのリストです。
- `config`: TiCDCが使用する構成ファイルのアドレス（オプション）。このオプションはTiCDC v5.0.0からサポートされています。このオプションはTiUP v1.4.0からTiCDCデプロイメントで使用できます。詳細な構成については、[TiCDC Changefeed構成](/ticdc/ticdc-changefeed-config.md)を参照してください。
- `data-dir`: TiCDCがディスクを使用してファイルを保存する場合に使用するディレクトリを指定します。TiCDCのソートエンジンとリドゥログは、一時ファイルを保存するためにこのディレクトリを使用します。このディレクトリの空き容量が500 GiB以上であることをお勧めします。TiUPを使用している場合は、[`cdc_servers`](/tiup/tiup-cluster-topology-reference.md#cdc_servers)セクションで`data_dir`を構成したり、デフォルトの`data_dir`パスを直接`global`で使用することができます。
- `gc-ttl`: TiCDCが設定したサービスレベルの`GC safepoint`のTTL（Time To Live）およびレプリケーションタスクが一時停止できる期間（秒単位）です。デフォルト値は`86400`で、つまり24時間です。注：TiCDCレプリケーションタスクの一時停止は、TiCDC GC safepointの進行に影響を与えます。これは、[TiCDC GC safepointの完全な挙動](/ticdc/ticdc-faq.md#what-is-the-complete-behavior-of-ticdc-garbage-collection-gc-safepoint)で詳細に説明されています。
- `log-file`: TiCDCプロセスが実行されているときにログが出力されるパスです。このパラメータが指定されていない場合、ログは標準出力（stdout）に書き込まれます。
- `log-level`: TiCDCプロセスが実行されているときのログレベルです。デフォルト値は`"info"`です。
- `ca`: TLS接続のためのPEM形式のCA証明書ファイルのパスを指定します（オプション）。
- `cert`: TLS接続のためのPEM形式の証明書ファイルのパスを指定します（オプション）。
- `cert-allowed-cn`: TLS接続のためのPEM形式の共通名のパスを指定します（オプション）。
- `key`: TLS接続のためのPEM形式の秘密鍵ファイルのパスを指定します（オプション）。
- `tz`: TiCDCサービスで使用されるタイムゾーンです。TiCDCは、内部的に`TIMESTAMP`などの時刻データ型を変換するときや、下流にデータを複製するときにこのタイムゾーンを使用します。デフォルトはプロセスが実行されるローカルタイムゾーンです。`tz`と`time-zone`（`sink-uri`で指定）を同時に指定する場合は、内部TiCDCプロセスは`tz`で指定されたタイムゾーンを使用し、シンクは下流にデータをレプリケートするために`time-zone`で指定されたタイムゾーンを使用します。`tz`で指定されたタイムゾーンが`time-zone`（`sink-uri`で指定）で指定されたものと同じであることを確認してください。
- `cluster-id`: (オプション) TiCDCクラスターのIDです。デフォルト値は`default`です。`cluster-id`はTiCDCクラスターの一意の識別子です。同じ`cluster-id`を持つTiCDCノードは同じクラスターに属します。`cluster-id`の長さは最大で128文字です。`cluster-id`は`^[a-zA-Z0-9]+(-[a-zA-Z0-9]+)*$`のパターンに従う必要があり、以下のいずれかであってはなりません: `owner`、`capture`、`task`、`changefeed`、`job`、`meta`。

## `cdc server`構成ファイルのパラメータ

以下に、`cdc server`コマンドで`config`オプションで指定された構成ファイルについて説明します：

```toml
# 以下のパラメータの構成方法はCLIパラメータと同じですが、CLIパラメータの方が優先順位が高くなります。
addr = "127.0.0.1:8300"
advertise-addr = ""
log-file = ""
log-level = "info"
data-dir = ""
gc-ttl = 86400 # 24 時間
tz = "System"
cluster-id = "default"

[security]
  ca-path = ""
  cert-path = ""
  key-path = ""

# TiCDCとetcdサービス間のセッション期間。このパラメータはオプションで、デフォルト値は10です。
capture-session-ttl = 10 # 10秒

# TiCDCクラスターのOwnerモジュールがレプリケーション進行状況をプッシュしようとする間隔。このパラメータはオプションで、デフォルト値は`50000000`ナノ秒（つまり50ミリ秒）です。このパラメータは2通りで設定できます: 数値のみを指定する方法（例えば、`40000000`と構成すると40000000ナノ秒、つまり40ミリ秒を表す）、または数値と単位の両方を指定する方法（例えば、`40ms`として直接構成する）。
owner-flush-interval = 50000000 # 50 ms

# TiCDCクラスターのProcessorモジュールがレプリケーション進行状況をプッシュしようとする間隔。このパラメータはオプションで、デフォルト値は`50000000`ナノ秒（つまり50ミリ秒）です。このパラメータの構成方法は`owner-flush-interval`と同じです。
processor-flush-interval = 50000000 # 50 ms

#[log]
# # zapログモジュールの内部エラーログの出力先。このパラメータはオプションで、デフォルト値は "stderr" です。
#   error-output = "stderr"
#   [log.file]
#     # 単一のログファイルの最大サイズ。このパラメータはオプションで、デフォルト値は300です（MiB単位）。
#     max-size = 300 # 300 MiB
#     # ログファイルを保持する最大日数。このパラメータはオプションで、デフォルト値は `0` で、つまり削除しないことを意味します。
#     max-days = 0
#     # 保持するログファイルの数。このパラメータはオプションで、デフォルト値は `0` で、すべてのログファイルを保持します。
#     max-backups = 0

#[sorter]
# デフォルトで開始される8つのpebble DB用のSorterモジュールの共有pebbleブロックキャッシュのサイズ。デフォルト値は128です（MiB単位）。
# cache-size-in-mb = 128
# ソータファイルが保存されるディレクトリ（`data-dir`に対して相対的な場所）。このパラメータはオプションで、デフォルト値は "/tmp/sorter" です。
# sorter-dir = "/tmp/sorter"

# [kv-client]
#   単一のリージョンワーカーで使用できるスレッド数。このパラメータはオプションで、デフォルト値は8です。
#   worker-concurrent = 8
#   TiCDCの共有スレッドプールで使用できるスレッド数。主にKVイベントの処理に使用されます。このパラメータはオプションで、デフォルト値は0で、デフォルトのプールサイズはCPUコア数の2倍です。
#   worker-pool-size = 0
#   リージョン接続のリトライ期間。このパラメータはオプションで、デフォルト値は`60000000000`ナノ秒（つまり1分）です。このパラメータは2通りで設定できます: 数値のみを指定する方法（例えば、`50000000`と構成すると50000000ナノ秒、つまり50ミリ秒を表す）、または数値と単位の両方を指定する方法（例えば、`50ms`として直接構成する）。
#   region-retry-duration = 60000000000
```