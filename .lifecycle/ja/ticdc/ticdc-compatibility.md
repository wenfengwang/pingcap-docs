---
title: TiCDCの互換性
summary: TiCDCの互換性の問題とその対処方法について学びます。

# TiCDCの互換性

このセクションではTiCDCに関連する互換性の問題とその対処方法について説明します。

<!--
## コンポーネントの互換性マトリックス

TODO

## 機能の互換性マトリックス

TODO
-->

## CLIと構成ファイルの互換性

* TiCDC v4.0.0では、`ignore-txn-commit-ts`が削除され、`ignore-txn-start-ts`が追加され、これによりstart_tsがトランザクションをフィルタリングします。
* TiCDC v4.0.2では、`db-dbs`/`db-tables`/`ignore-dbs`/`ignore-tables`が削除され、`rules`が追加され、新しいデータベースとテーブルのフィルタルールに使用されます。詳細なフィルタ構文については、[テーブルフィルタ](/table-filter.md)を参照してください。
* TiCDC v6.2.0以降、`cdc cli`はTiCDCオープンAPIを介してTiCDCサーバーと直接やり取りできます。`--server`パラメータを使用してTiCDCサーバーのアドレスを指定できます。`--pd`は非推奨となります。
* v6.4.0以降、`SYSTEM_VARIABLES_ADMIN`または`SUPER`権限を持つ変更フィードのみがTiCDC Syncpoint機能を使用できます。

## 互換性の問題の対処

このセクションではTiCDCに関連する互換性の問題とその対処方法について説明します。

### TiCDC v5.0.0-rcの`cdc cli`ツールを使用してv4.0.xクラスターを操作した場合の非互換性の問題

TiCDC v5.0.0-rcの`cdc cli`ツールを使用してv4.0.x TiCDCクラスターを操作すると、次の異常な状況に遭遇する可能性があります。

- TiCDCクラスターがv4.0.8またはそれ以前のバージョンの場合、v5.0.0-rcの`cdc cli`ツールを使用してレプリケーションタスクを作成すると、クラスターの異常およびレプリケーションタスクのスタックが発生する可能性があります。

- TiCDCクラスターがv4.0.9またはそれ以降のバージョンの場合、v5.0.0-rcの`cdc cli`ツールを使用してレプリケーションタスクを作成すると、古い値と統一ソータ機能がデフォルトで予期せず有効になります。

解決策:

以下の操作を行うには、TiCDCクラスターバージョンに対応する`cdc`実行可能ファイルを使用します。

1. v5.0.0-rcの`cdc cli`ツールで作成された変更フィードを削除します。たとえば、`tiup cdc:v4.0.9 cli changefeed remove -c xxxx --pd=xxxxx --force`コマンドを実行します。
2. レプリケーションタスクがスタックした場合は、TiCDCクラスターを再起動します。たとえば、`tiup cluster restart <cluster_name> -R cdc`コマンドを実行します。
3. 変更フィードを再作成します。たとえば、`tiup cdc:v4.0.9 cli changefeed create --sink-uri=xxxx --pd=xxx`コマンドを実行します。

> **注意:**
>
> この問題は`cdc cli`がv5.0.0-rcの場合にのみ存在します。他のv5.0.xバージョンの`cdc cli`ツールはv4.0.xクラスターと互換性があります。

###`sort-dir`および`data-dir`の互換性に関する注意事項

`sort-dir`構成はTiCDCソータの一時ファイルディレクトリを指定するために使用されます。その機能は異なるバージョンで異なる場合があります。次の表に、バージョン間の`sort-dir`の互換性の変更が列挙されています。

|  バージョン  |  `sort-engine` 機能  |  注釈   |  推奨   |
|  :---  |    :---               |  :--    | :-- |
| v4.0.11またはそれ以前のv4.0バージョン、v5.0.0-rc | `file`ソータと`unified`ソータの一時ファイルディレクトリを指定する変更フィード構成項目です。 | これらのバージョンでは、`file`ソータと`unified`ソータは**実験的機能**であり、製品環境での使用は**推奨されていません**。<br/><br/>複数の変更フィードが`sort-engine`として`unified`ソータを使用する場合、実際の一時ファイルディレクトリはどの変更フィードの`sort-dir`構成でもありえますし、各TiCDCノードで使用されるディレクトリは異なる場合もあります。 | 製品環境で`unified`ソータを使用することは推奨されていません。 |
| v4.0.12、v4.0.13、v5.0.0、およびv5.0.1 |  変更フィードまたは`cdc server`の構成項目です。 | デフォルトで、変更フィードの`sort-dir`構成は効果を持たず、`cdc server`の`sort-dir`構成はデフォルトで`/tmp/cdc_sort`になります。製品環境では`cdc server`のみを構成することをお勧めします。<br /><br />TiUPを使用してTiCDCを展開する場合、最新のTiUPバージョンを使用して`sorter.sort-dir`をTiCDCサーバーの構成に設定することをお勧めします。<br /><br />v4.0.13、v5.0.0、およびv5.0.1では、`unified`ソータがデフォルトで有効になります。これらのバージョンにクラスターをアップグレードする場合は、TiCDCサーバーの構成で`sorter.sort-dir`を正しく設定していることを確認してください。 | `sort-dir`を`cdc server`のコマンドラインパラメータ（またはTiUP）を使用して構成する必要があります。 |
|  v4.0.14およびそれ以降のv4.0バージョン、v5.0.3およびそれ以降のv5.0バージョン、およびその後のTiDBバージョン | `sort-dir`は非推奨です。`data-dir`を構成することが推奨されます。 | 最新バージョンのTiUPを使用して`data-dir`を構成できます。これらのTiDBバージョンでは、`unified`ソータがデフォルトで有効になります。クラスターをアップグレードする場合は、`data-dir`が正しく構成されていることを確認してください。さもなければ、一時ファイルディレクトリとしてデフォルトで`/tmp/cdc_data`が使用されます。<br /><br />ディレクトリが存在するデバイスのストレージ容量が不十分な場合、ディスクの空き容量不足の問題が発生する可能性があります。この状況では、変更フィードの以前の`sort-dir`構成が無効になります。 | `data-dir`を`cdc server`のコマンドラインパラメータ（またはTiUP）を使用して構成する必要があります。 |
| v6.0.0およびそれ以降のバージョン | `data-dir`はTiCDCが生成した一時ファイルを保存するために使用されます。 | v6.0.0から、TiCDCはデフォルトで`db sorter`をソートエンジンとして使用します。 `data-dir`はこのエンジンのディスクディレクトリです。 | `data-dir`を`cdc server`のコマンドラインパラメータ（またはTiUP）を使用して構成する必要があります。  |

### 一時テーブルの互換性

v5.3.0以降、TiCDCは[グローバル一時テーブル](/temporary-tables.md#global-temporary-tables)をサポートしています。v5.3.0より前のバージョンのTiCDCを使用してグローバル一時テーブルをダウンストリームにレプリケートすると、テーブル定義エラーが発生します。

上流クラスターにグローバル一時テーブルが含まれている場合、下流のTiDBクラスターはv5.3.0以上のバージョンである必要があります。そうでない場合、レプリケーションプロセス中にエラーが発生します。